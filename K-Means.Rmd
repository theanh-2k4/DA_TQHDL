---
title: "" 
author: ""
date: ""
output:
  pdf_document:
    latex_engine: xelatex
    toc: false
    toc_depth: 3
    number_sections: false
    fig_caption: true
    keep_tex: true
  html_document: default
header-includes:
  - \renewcommand{\contentsname}{Má»¤C Lá»¤C}
  - \usepackage{graphicx}
  - \usepackage{fontspec}
  - \usepackage{tikz}
  - \usepackage{geometry}
  - \geometry{a4paper, margin=2.5cm}
  - \setmainfont{Times New Roman}
  - \usetikzlibrary{calc}
---
```{=latex}
\begin{titlepage}
\begin{center}

\vspace*{-2cm}

\begin{tikzpicture}[remember picture, overlay]
  \draw[line width=0.8pt]
    ($(current page.north west) + (1.5cm,-1.5cm)$)
    rectangle
    ($(current page.south east) + (-1.5cm,1.5cm)$);
\end{tikzpicture}


\noindent
\begin{minipage}{0.3\textwidth}
\includegraphics[width=\linewidth]{logo.png.jpg}
\end{minipage}
\hfill
\begin{minipage}{0.65\textwidth}
\centering
\textbf{Bá»˜ GIÃO Dá»¤C VÃ€ ÄÃ€O Táº O}\\[0.2cm]
\textbf{TRÆ¯á»œNG Äáº I Há»ŒC CÃ”NG NGHá»† TP.HCM}
\end{minipage}

\vfill 


\begin{center}

\textbf{\Large Äá»’ ÃN MÃ”N Há»ŒC}\\[1cm]

\textbf{\large \uppercase{á»¨NG Dá»¤NG RFM, K-MEANS VÃ€ DBSCAN TRONG}}\\
\textbf{\large \uppercase{PHÃ‚N KHÃšC KHÃCH HÃ€NG VÃ€ Tá»I Æ¯U DOANH THU}}\\[1.2cm]

\begin{flushleft}
\textbf{NgÃ nh:} \textbf{KHOA Há»ŒC Dá»® LIá»†U}\\
\textbf{MÃ´n há»c:} \textbf{PHÃ‚N TÃCH VÃ€ TRá»°C QUAN Dá»® LIá»†U}\\[1cm]

\textbf{Giáº£ng viÃªn hÆ°á»›ng dáº«n:} \textbf{LÃŠ NHáº¬T TÃ™NG}\\
\textbf{Sinh viÃªn thá»±c hiá»‡n:}
\end{flushleft}

\vspace{0.3cm}

\begin{tabular}{ll}
Nguyá»…n Nháº­t Nam      & MSSV: 2286400019 \\
HoÃ ng Quang Minh     & MSSV: 2286400017 \\
HÃ  Tháº¿ Anh           & MSSV: 2286400002 \\
\end{tabular}

\vspace{0.5cm}

\textbf{Lá»›p:} \textbf{22DKHA1}

\end{center}

\vfill


\begin{center}
TP. Há»“ ChÃ­ Minh, 2025
\end{center}

\end{center}
\end{titlepage}
```

\newpage
\tableofcontents
\newpage



# **Thuáº­t toÃ¡n phÃ¢n cá»¥m K â€“ Means**

## KhÃ¡i niá»‡m vá» K â€“ Means

Thuáº­t toÃ¡n K-means lÃ  má»™t ká»¹ thuáº­t há»c khÃ´ng giÃ¡m sÃ¡t ná»•i báº­t, Ä‘Æ°á»£c á»©ng dá»¥ng rá»™ng rÃ£i trong phÃ¢n tÃ­ch dá»¯ liá»‡u nháº±m chia táº­p dá»¯ liá»‡u chÆ°a gÃ¡n nhÃ£n thÃ nh cÃ¡c nhÃ³m (cá»¥m) sao cho cÃ¡c Ä‘iá»ƒm dá»¯ liá»‡u trong cÃ¹ng má»™t cá»¥m cÃ³ má»©c Ä‘á»™ tÆ°Æ¡ng Ä‘á»“ng cao, trong khi sá»± khÃ¡c biá»‡t giá»¯a cÃ¡c cá»¥m lÃ  tá»‘i Ä‘a. NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng cá»§a K-means dá»±a trÃªn viá»‡c tá»‘i thiá»ƒu hÃ³a tá»•ng bÃ¬nh phÆ°Æ¡ng khoáº£ng cÃ¡ch giá»¯a cÃ¡c Ä‘iá»ƒm dá»¯ liá»‡u vÃ  tÃ¢m cá»¥m mÃ  chÃºng Ä‘Æ°á»£c gÃ¡n vÃ o. Má»—i Ä‘iá»ƒm sáº½ Ä‘Æ°á»£c phÃ¢n vÃ o cá»¥m cÃ³ trung tÃ¢m gáº§n nháº¥t, vÃ  cÃ¡c tÃ¢m cá»¥m Ä‘Æ°á»£c cáº­p nháº­t liÃªn tá»¥c cho Ä‘áº¿n khi Ä‘áº¡t Ä‘Æ°á»£c tráº¡ng thÃ¡i há»™i tá»¥.


Má»¥c tiÃªu chÃ­nh cá»§a K-Means lÃ  giáº£m thiá»ƒu tá»•ng bÃ¬nh phÆ°Æ¡ng khoáº£ng cÃ¡ch giá»¯a cÃ¡c Ä‘iá»ƒm dá»¯ liá»‡u vÃ  trung tÃ¢m cá»¥m cá»§a chÃºng, Ä‘Æ°á»£c gá»i lÃ  Within-Cluster Sum of Squares (WCSS):

$$WCSS = \sum_{i=1}^{K} \sum_{x \in C_i} \| x - \mu_i \|^2$$
Trong Ä‘Ã³:

- $K$: LÃ  sá»‘ lÆ°á»£ng cá»¥m  
- $C_i$: LÃ  táº­p há»£p cÃ¡c Ä‘iá»ƒm thuá»™c cá»¥m thá»© $i$  
- $\mu_i$: LÃ  trung tÃ¢m (tÃ¢m cá»¥m) cá»§a cá»¥m thá»© $i$  
- $\|x - \mu_i\|^2$: LÃ  bÃ¬nh phÆ°Æ¡ng khoáº£ng cÃ¡ch Euclidean giá»¯a Ä‘iá»ƒm $x$ vÃ  tÃ¢m cá»¥m $\mu_i$

## CÃ¡ch hoáº¡t Ä‘á»™ng cá»§a K-Means

BÆ°á»›c 1: Chá»n sá»‘ lÆ°á»£ng cá»¥m

  - XÃ¡c Ä‘á»‹nh sá»‘ lÆ°á»£ng cá»¥m $K$ mÃ  ta sáº½ nhÃ³m dá»¯ liá»‡u. VÃ­ dá»¥ chá»n $K = 3$.
  
BÆ°á»›c 2: Khá»Ÿi táº¡o tÃ¢m cá»¥m ban Ä‘áº§u

  -	Do vá»‹ trÃ­ chÃ­nh xÃ¡c cá»§a cÃ¡c tÃ¢m cá»¥m chÆ°a Ä‘Æ°á»£c biáº¿t, nÃªn á»Ÿ giai Ä‘oáº¡n khá»Ÿi táº¡o, thuáº­t toÃ¡n sáº½ chá»n ngáº«u nhiÃªn K Ä‘iá»ƒm tá»« táº­p dá»¯ liá»‡u vÃ  coi Ä‘Ã³ lÃ  cÃ¡c tÃ¢m cá»¥m ban Ä‘áº§u.


BÆ°á»›c 3: GÃ¡n Ä‘iá»ƒm dá»¯ liá»‡u cho cá»¥m gáº§n nháº¥t

  -	Sau khi Ä‘Ã£ cÃ³ tÃ¢m cá»¥m ban Ä‘áº§u, má»—i Ä‘iá»ƒm dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c gÃ¡n vÃ o cá»¥m cÃ³ tÃ¢m gáº§n nháº¥t. Khoáº£ng cÃ¡ch giá»¯a Ä‘iá»ƒm dá»¯ liá»‡u vÃ  tÃ¢m cá»¥m thÆ°á»ng Ä‘Æ°á»£c Ä‘o báº±ng khoáº£ng cÃ¡ch Euclidean. Äiá»ƒm dá»¯ liá»‡u sáº½ thuá»™c vá» cá»¥m cÃ³ tÃ¢m mÃ  nÃ³ cÃ³ khoáº£ng cÃ¡ch Euclidean ngáº¯n nháº¥t.

  - Äo khoáº£ng cÃ¡ch tá»« cÃ¡c Ä‘iá»ƒm tá»›i tÃ¢m cá»¥m báº±ng phÃ©p Ä‘o khoáº£ng cÃ¡ch Euclidean.

$$d(x, y) = \sqrt{ \sum_{i=1}^{n} (x_i - y_i)^2 }$$

  - Sau Ä‘Ã³ chá»n cá»¥m cho dá»¯ liá»‡u cÃ³ khoáº£ng cÃ¡ch giá»¯a cÃ¡c Ä‘iá»ƒm dá»¯ liá»‡u vÃ  tÃ¢m nhá» nháº¥t.


BÆ°á»›c 4: Khá»Ÿi táº¡o láº¡i tÃ¢m cá»¥m

  - Khá»Ÿi táº¡o láº¡i trá»ng tÃ¢m báº±ng cÃ¡ch tÃ­nh toÃ¡n giÃ¡ trá»‹ trung bÃ¬nh cá»§a táº¥t cáº£ cÃ¡c Ä‘iá»ƒm dá»¯ liá»‡u cá»§a cá»¥m Ä‘Ã³.
  
$$C_i = \frac{1}{|N_i|} \sum x_i$$

Trong Ä‘Ã³:

- $C_i$: lÃ  tÃ¢m cá»¥m thá»© $i$ (centroid cá»§a cá»¥m $i$)  
- $N_i$: lÃ  táº­p cÃ¡c Ä‘iá»ƒm thuá»™c cá»¥m $i$  
- $|N_i|$: lÃ  sá»‘ lÆ°á»£ng Ä‘iá»ƒm trong cá»¥m $i$ (kÃ­ch thÆ°á»›c cá»¥m)  
- $\sum x_i$: lÃ  tá»•ng cÃ¡c vector dá»¯ liá»‡u $x_i$ trong cá»¥m $i$


BÆ°á»›c 5: Láº·p láº¡i 

  -	Tiáº¿n hÃ nh láº·p láº¡i bÆ°á»›c 3 vÃ  bÆ°á»›c 4 cho Ä‘áº¿n khi cÃ³ Ä‘Æ°á»£c trá»ng tÃ¢m tá»‘i Æ°u vÃ  viá»‡c chá»‰ Ä‘á»‹nh cÃ¡c Ä‘iá»ƒm dá»¯ liá»‡u cho cÃ¡c cá»¥m chÃ­nh xÃ¡c khÃ´ng cÃ²n thay Ä‘á»•i.


## Lá»±a chá»n K cho K â€“ Means

Má»™t trong nhá»¯ng thÃ¡ch thá»©c lá»›n nháº¥t khi sá»­ dá»¥ng K-Means lÃ  xÃ¡c Ä‘á»‹nh sá»‘ lÆ°á»£ng cá»¥m K phÃ¹ há»£p. KhÃ´ng cÃ³ má»™t giÃ¡ trá»‹ K tá»‘i Æ°u duy nháº¥t cho má»i bá»™ dá»¯ liá»‡u, vÃ  viá»‡c chá»n K phá»¥ thuá»™c vÃ o Ä‘áº·c Ä‘iá»ƒm cá»§a dá»¯ liá»‡u vÃ  má»¥c tiÃªu phÃ¢n tÃ­ch. DÆ°á»›i Ä‘Ã¢y lÃ  nhá»¯ng phÆ°Æ¡ng phÃ¡p chá»n K cho tá»‘i Æ°u:

**PhÆ°Æ¡ng phÃ¡p Elbow (Khuá»·u tay)**: TÃ¬m sá»‘ lÆ°á»£ng cá»¥m sao cho tá»•ng phÆ°Æ¡ng sai trong cá»¥m (WSS â€“ within-cluster sum of squares) lÃ  nhá» nháº¥t, nhÆ°ng khÃ´ng giáº£m quÃ¡ nhiá»u khi tÄƒng thÃªm cá»¥m. CÃ´ng thá»©c WCSS:

$$WCSS = \sum_{i=1}^{K} \sum_{x \in C_i} \| x - \mu_i \|^2$$

  -	**CÃ¡ch thá»±c hiá»‡n:**
  
    *	Thá»±c hiá»‡n phÃ¢n cá»¥m vá»›i cÃ¡c giÃ¡ trá»‹ K khÃ¡c nhau (vÃ­ dá»¥ tá»« 1 Ä‘áº¿n 10).
    *	TÃ­nh tá»•ng WSS cho má»—i K.
    *	Váº½ biá»ƒu Ä‘á»“ WSS theo sá»‘ cá»¥m K.
    *	Äiá»ƒm "gáº¥p khÃºc" (elbow) trÃªn Ä‘á»“ thá»‹ thÆ°á»ng lÃ  nÆ¡i phÃ¹ há»£p Ä‘á»ƒ chá»n K.
    
**PhÆ°Æ¡ng phÃ¡p Silhouette**: ÄÃ¡nh giÃ¡ má»©c Ä‘á»™ phÃ¹ há»£p cá»§a tá»«ng Ä‘iá»ƒm dá»¯ liá»‡u vá»›i cá»¥m cá»§a nÃ³. GiÃ¡ trá»‹ Silhouette cÃ ng gáº§n 1 cho tháº¥y Ä‘iá»ƒm Ä‘Ã³ náº±m â€œÄ‘Ãºngâ€ trong cá»¥m hÆ¡n.

  - **CÃ¡ch thá»±c hiá»‡n:**
    *	PhÃ¢n cá»¥m dá»¯ liá»‡u vá»›i cÃ¡c giÃ¡ trá»‹ khÃ¡c nhau.
    *	TÃ­nh Ä‘á»™ rá»™ng silhouette trung bÃ¬nh cho má»—i giÃ¡ trá»‹ K.
    *	Váº½ Ä‘á»“ thá»‹ silhouette theo K.
    *	Chá»n K táº¡i vá»‹ trÃ­ cÃ³ giÃ¡ trá»‹ silhouette trung bÃ¬nh lá»›n nháº¥t.
    
  - **CÃ´ng thá»©c:**

$$
s(i) = \frac{b(i) - a(i)}{\max(a(i),\ b(i))}
$$
    a(i): Khoáº£ng cÃ¡ch trung bÃ¬nh tá»« Ä‘iá»ƒm *i* Ä‘áº¿n táº¥t cáº£ cÃ¡c Ä‘iá»ƒm khÃ¡c trong cÃ¹ng cá»¥m.
    b(i): Khoáº£ng cÃ¡ch trung bÃ¬nh nhá» nháº¥t tá»« Ä‘iá»ƒm *i* Ä‘áº¿n cÃ¡c Ä‘iá»ƒm trong cá»¥m khÃ¡c gáº§n nháº¥t.

- **Káº¿t quáº£ Silhouette tráº£ vá» náº±m trong khoáº£ng** \([-1, 1]\):
  - Gáº§n **1**: Äiá»ƒm dá»¯ liá»‡u Ä‘Æ°á»£c phÃ¢n cá»¥m **ráº¥t tá»‘t**.
  - Gáº§n **0**: Äiá»ƒm dá»¯ liá»‡u náº±m á»Ÿ **ranh giá»›i giá»¯a hai cá»¥m**.
  - Gáº§n **-1**: Äiá»ƒm dá»¯ liá»‡u cÃ³ thá»ƒ bá»‹ **phÃ¢n cá»¥m sai hoÃ n toÃ n**.

- **ÄÃ¡nh giÃ¡ cháº¥t lÆ°á»£ng phÃ¢n cá»¥m dá»±a trÃªn Silhouette trung bÃ¬nh**:
  - **0.71 â€“ 1.00**: Cáº¥u trÃºc phÃ¢n cá»¥m **máº¡nh**.
  - **0.51 â€“ 0.70**: Cáº¥u trÃºc phÃ¢n cá»¥m **há»£p lÃ½**.
  - **0.26 â€“ 0.50**: Cáº¥u trÃºc phÃ¢n cá»¥m **yáº¿u**, nÃªn **xem xÃ©t láº¡i**.
  - **â‰¤ 0.25**: **KhÃ´ng phÃ¡t hiá»‡n Ä‘Æ°á»£c** cáº¥u trÃºc phÃ¢n cá»¥m rÃµ rÃ ng.



```{r}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
# Äáº·t locale Ä‘á»ƒ há»— trá»£ tiáº¿ng Viá»‡t trong Ä‘á»“ thá»‹
Sys.setlocale("LC_ALL", "Vietnamese")
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE}
library(tidyverse)
library(cluster)
library(factoextra)
library(lubridate)
library(scales)
library(psych)
library(readxl)
library(dplyr)
library(ggplot2)
library(plotly)
library(gridExtra)
```


# Äá»c vÃ  khÃ¡m phÃ¡ dá»¯ liá»‡u

```{r}
# Äá»c dá»¯ liá»‡u
df <- read_excel("Online Retail.xlsx")
head(df)  

```

  InvoiceNo: MÃ£ Ä‘Æ¡n hÃ ng 
  
  StockCode: MÃ£ sáº£n pháº©m 
  
  Description: MÃ´ táº£ sáº£n pháº©m 
  
  Quantity: Sá»‘ lÆ°á»£ng sáº£n pháº©m 
  
  InvoiceDate: NgÃ y hÃ³a Ä‘Æ¡n 
  
  UnitPrice: GiÃ¡ sáº£n pháº©m trÃªn má»—i Ä‘Æ¡n vá»‹ 
  
  CustomerID: MÃ£ khÃ¡ch hÃ ng 
  
  Country: Quá»‘c gia cá»§a khÃ¡ch hÃ ng
  

```{r}
#Kiá»ƒm tra kiá»ƒu dá»¯ liá»‡u
str(df)
```


```{r}
# thá»‘ng kÃª mÃ´ táº£ dá»¯ liá»‡u 
describe(df)
```

```{r}
# Thá»‘ng kÃª data object 
summary(df[, sapply(df, is.character)])
```
```{r}
#kiá»ƒm tra dá»¯ liá»‡u thiáº¿u 
colSums(is.na(df))
```


```{r}
# Kiá»ƒm tra giÃ¡ trá»‹ thiáº¿u cá»§a CustomerID
df_na <- df[is.na(df$CustomerID), ]
print(df_na[sample(nrow(df_na), 10), ], width = Inf)
```

```{r}
# Chuyá»ƒn 'InvoiceNo' vá» kiá»ƒu chuá»—i
df$InvoiceNo <- as.character(df$InvoiceNo)
#Lá»c ra nhá»¯ng dÃ²ng KHÃ”NG cÃ³ InvoiceNo Ä‘Ãºng 6 chá»¯ sá»‘
df[!grepl("^\\d{6}$", df$InvoiceNo), ]

#Kiá»ƒm tra kÃ­ tá»± khÃ¡c trong cá»™t InvoiceNo 
unique(gsub("[0-9]", "", df$InvoiceNo))

# kiá»ƒm tra col 'InvoiceNo' cÃ³ giÃ¡ trá»‹ nÃ o báº¯t Ä‘áº§u báº±ng kÃ­ tá»± 'A' ko
df[grepl("^A", df$InvoiceNo), ]
```
```{r}
# Äáº£m báº£o 'StockCode' lÃ  kiá»ƒu chuá»—i
df$StockCode <- as.character(df$StockCode)
# Lá»c nhá»¯ng dÃ²ng KHÃ”NG pháº£i 5 chá»¯ sá»‘ hoáº·c 5 chá»¯ sá»‘ + chá»¯ cÃ¡i
mask <- !(grepl("^\\d{5}$", df$StockCode) | grepl("^\\d{5}[a-zA-Z]+$", df$StockCode))
# Láº¥y cÃ¡c StockCode sai Ä‘á»‹nh dáº¡ng vÃ  loáº¡i trÃ¹ng
invalid_stockcodes <- unique(df$StockCode[mask])
# Hiá»ƒn thá»‹ káº¿t quáº£
print(invalid_stockcodes)
# Lá»c nhá»¯ng dÃ²ng cÃ³ chá»©a chuá»—i 'DOT'
df_with_DOT <- df[grepl("DOT", df$StockCode), ]
# Hiá»ƒn thá»‹ káº¿t quáº£
print(df_with_DOT)
```

 **Stock Code**

- **Include** ğŸŸ¢ â†’ Giá»¯ láº¡i Ä‘á»ƒ phÃ¢n tÃ­ch hoáº·c clustering.  
- **Exclude** âŒ â†’ Loáº¡i bá» hoÃ n toÃ n, khÃ´ng dÃ¹ng Ä‘á»ƒ phÃ¢n tÃ­ch.  
- **Exclude from clustering** ğŸš« â†’ KhÃ´ng dÃ¹ng Ä‘á»ƒ phÃ¢n nhÃ³m nhÆ°ng cÃ³ thá»ƒ tham kháº£o.  
- **Exclude for now** â³ â†’ Táº¡m loáº¡i bá», cÃ³ thá»ƒ xem xÃ©t láº¡i sau. 

- **StockCode** is meant to follow the pattern `[0-9]{5}` but seems to have legit values for `[0-9]{5}[a-zA-Z]+`.  
&nbsp;&nbsp;&nbsp;&nbsp; **Also contains other values:** 



| Code             | Description                                                                 | Action                      |
|------------------|-----------------------------------------------------------------------------|-----------------------------|
| POST            | Not listed previously, likely a postage-related transaction                | Exclude for now             |
| D               | Looks valid, represents discount values                                    | Exclude from clustering     |
| C2              | Carriage transaction - not sure what this means                           | Exclude from clustering     |
| DOT             | Looks valid, represents postage charges                                   | Exclude from clustering     |
| M or m          | Looks valid, represents manual transactions                               | Exclude from clustering     |
| BANK CHARGES or B | Bank charges                                                           | Exclude from clustering     |
| S               | Samples sent to customer                                                 | Exclude from clustering     |
| AMAZONFEE       | Looks like fees for Amazon shipping or something                         | Exclude for now             |
| DCGS0076        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0003        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| gift_0001_40    | Purchases with gift cards, might be interesting for another analysis, but no customer data | Exclude |
| DCGS0070        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| m               | Looks valid, represents manual transactions                              | Exclude from clustering     |
| gift_0001_50    | Purchases with gift cards, might be interesting for another analysis, but no customer data | Exclude |
| gift_0001_30    | Purchases with gift cards, might be interesting for another analysis, but no customer data | Exclude |
| gift_0001_20    | Purchases with gift cards, might be interesting for another analysis, but no customer data | Exclude |
| DCGS0055        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0072        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0074        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0069        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0057        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGSSBOY        | Possible category or bundle-related code                                 | Exclude for now             |
| DCGSSGIRL       | Possible category or bundle-related code                                 | Exclude for now             |
| gift_0001_10    | Purchases with gift cards, might be interesting for another analysis, but no customer data | Exclude |
| PADS            | Looks like a legit stock code for padding                                | Include                     |
| DCGS0004        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0073        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0071        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0068        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0067        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0066P       | Variant of DCGS, possibly a special category                            | Exclude from clustering     |
| B               | Bank charges                                                             | Exclude from clustering     |
| CRUK            | Unknown, possibly a charity-related code                                | Exclude for now             |


# Xá»­ lÃ½ dá»¯ liá»‡u 

```{r}
# Chuyá»ƒn InvoiceDate thÃ nh kiá»ƒu Date
df$InvoiceDate <- as.Date(df$InvoiceDate)
str(df)
```

```{r}
# 1. GÃ¡n láº¡i df gá»‘c
df_cleaned <- df
# Loáº¡i bá» toÃ n bá»™ dÃ²ng chá»©a báº¥t ká»³ kÃ½ tá»± KHÃ”NG PHáº¢I sá»‘ (0â€“9)
df_cleaned <- df_cleaned[grepl("^[0-9]+$", df_cleaned$InvoiceNo), ]

```

```{r}
# Kiá»ƒm tra cÃ²n chá»¯ cÃ¡i khÃ´ng?
any(grepl("[A-Za-z]", df_cleaned$InvoiceNo))  # Pháº£i tráº£ FALSE

# Kiá»ƒm tra cÃ²n kÃ½ tá»± Ä‘áº·c biá»‡t khÃ´ng?
any(grepl("[^0-9]", df_cleaned$InvoiceNo))    # Pháº£i tráº£ FALSE
```

```{r}
# Táº¡o Ä‘iá»u kiá»‡n giá»¯ láº¡i cÃ¡c StockCode há»£p lá»‡:
mask <- grepl("^\\d{5,6}$", df_cleaned$StockCode) |           # ToÃ n sá»‘, 5-6 chá»¯ sá»‘
        grepl("^\\d{5}[A-Za-z]$", df_cleaned$StockCode) |     # 5 sá»‘ + 1 chá»¯ cÃ¡i
        df_cleaned$StockCode == "APADSS"                      # MÃ£ Ä‘áº·c biá»‡t

# Ãp dá»¥ng lá»c
df_cleaned <- df_cleaned[mask, ]

df_cleaned
```
```{r}
sum(is.na(df$CustomerID))  # Ä‘áº¿m sá»‘ dÃ²ng bá»‹ thiáº¿u
```

```{r}
# XÃ³a cÃ¡c dÃ²ng cÃ³ NA á»Ÿ cá»™t CustomerID
df_cleaned <- df_cleaned[!is.na(df_cleaned$CustomerID), ]

nrow(df) - nrow(df_cleaned)  # sá»‘ dÃ²ng Ä‘Ã£ bá»‹ xÃ³a

colSums(is.na(df_cleaned))
```

```{r}
# thá»‘ng kÃª data sau khi drop na
summary(df_cleaned)

```

**Nháº­n xÃ©t tá»•ng quan vá» dá»¯ liá»‡u df_cleaned:**




```{r}
# kiá»ƒm tra giÃ¡ trá»‹ báº±ng 0 cá»§a col 'UnitPrice'
sum(df_cleaned$UnitPrice == 0)
# chá»‰ láº¥y giÃ¡ trá»‹ khÃ¡c 0 
df_cleaned <- df_cleaned[df_cleaned$UnitPrice > 0, ]
#Kiá»ƒm tra 
summary(df_cleaned)

```

```{r}
#TÃ­nh tá»· lá»‡ pháº§n trÄƒm sá»‘ dÃ²ng cÃ²n láº¡i trong df_cleaned so vá»›i tá»•ng sá»‘ dÃ²ng ban Ä‘áº§u trong df.
sprintf("%.2f%%", nrow(df_cleaned) / nrow(df) * 100)
```


```{r}
##Trá»±c quan hÃ³a
# Sá»‘ dÃ²ng ban Ä‘áº§u vÃ  sau khi lÃ m sáº¡ch
total_rows <- nrow(df)
cleaned_rows <- nrow(df_cleaned)
removed_rows <- total_rows - cleaned_rows
# Táº¡o dataframe Ä‘á»ƒ váº½
summary_df <- data.frame(
  status = c("Giá»¯ láº¡i", "ÄÃ£ loáº¡i"),
  quantity = c(cleaned_rows, removed_rows)
)
# Váº½ biá»ƒu Ä‘á»“
barplot(
  summary_df$quantity,
  names.arg = summary_df$status,
  col = c("skyblue", "salmon"),
  main = "So sÃ¡nh sá»‘ dÃ²ng trÆ°á»›c vÃ  sau khi lÃ m sáº¡ch",
  ylab = "Sá»‘ dÃ²ng",
  ylim = c(0, max(summary_df$quantity) * 1.1)
)
# Hiá»ƒn thá»‹ sá»‘ liá»‡u trÃªn cá»™t
text(
  x = c(1, 2),
  y = summary_df$quantity,
  labels = summary_df$quantity,
  pos = 3,
  cex = 1.2
)
```

##Analysis RFM 

```{r}
# táº¡o cá»™t tá»•ng chi tiÃªu lÃ m Monetary (tá»•ng chi tiÃªu)
df_cleaned$SalesLineTotal <- df_cleaned$Quantity * df_cleaned$UnitPrice
# Hiá»ƒn thá»‹ káº¿t quáº£
print(df_cleaned, width = Inf)
```


```{r}
aggregated_df <- summarise(
  group_by(df_cleaned, CustomerID),
  MonetaryValue = sum(SalesLineTotal, na.rm = TRUE),
  Frequency = n_distinct(InvoiceNo),
  LastInvoiceDate = max(InvoiceDate)
)
```


```{r}
# TÃ­nh Recency
analysis_date <- as.Date(max(df_cleaned$InvoiceDate))
aggregated_df$Recency <- as.numeric(analysis_date - aggregated_df$LastInvoiceDate)

print(aggregated_df, width = Inf)

```

```{r}
# Thiáº¿t láº­p bá»‘ cá»¥c 1 hÃ ng 3 biá»ƒu Ä‘á»“
par(mfrow = c(1, 3), mar = c(4, 4, 3, 1))  # 1 dÃ²ng, 3 cá»™t

# Biá»ƒu Ä‘á»“ 1: Monetary Value
hist(aggregated_df$MonetaryValue,
     breaks = 10,
     col = "skyblue",
     border = "red",
     main = "Monetary Value Distribution",
     xlab = "Monetary Value",
     ylab = "Count")

# Biá»ƒu Ä‘á»“ 2: Frequency
hist(aggregated_df$Frequency,
     breaks = 10,
     col = "lightgreen",
     border = "red",
     main = "Frequency Distribution",
     xlab = "Frequency",
     ylab = "Count")

# Biá»ƒu Ä‘á»“ 3: Recency
hist(aggregated_df$Recency,
     breaks = 20,
     col = "yellow",
     border = "red",
     main = "Recency Distribution",
     xlab = "Recency",
     ylab = "Count")

# Reset layout vá» máº·c Ä‘á»‹nh (1 biá»ƒu Ä‘á»“/khung)
par(mfrow = c(1, 1))
```
**Nháº­n xÃ©t**

  - **Monetary Value Distribution (GiÃ¡ trá»‹ chi tiÃªu):**
  
      * PhÃ¢n bá»‘ ráº¥t lá»‡ch pháº£i (right-skewed).

      * Pháº§n lá»›n khÃ¡ch hÃ ng cÃ³ tá»•ng chi tiÃªu (Monetary) ráº¥t tháº¥p (Ä‘a sá»‘ < 10,000).

      * Chá»‰ má»™t sá»‘ Ã­t khÃ¡ch chi tiÃªu ráº¥t cao (cÃ³ giÃ¡ trá»‹ tá»›i 250,000+), táº¡o ra outlier ráº¥t máº¡nh.
      
  - **Káº¿t luáº­n:**
    
      * Táº­p khÃ¡ch hÃ ng cÃ³ sá»± khÃ¡c biá»‡t lá»›n vá» giÃ¡ trá»‹ â€“ phÃ¹ há»£p Ä‘á»ƒ phÃ¢n nhÃ³m (clustering).
    
      * NÃªn xem xÃ©t log-transform hoáº·c winsorizing trÆ°á»›c khi dÃ¹ng cho mÃ´ hÃ¬nh.
    
  - **Frequency Distribution (Táº§n suáº¥t mua hÃ ng):**

      * Cá»±c ká»³ lá»‡ch pháº£i: gáº§n nhÆ° táº¥t cáº£ khÃ¡ch chá»‰ mua 1â€“2 láº§n.

      * Ráº¥t Ã­t khÃ¡ch hÃ ng mua tá»« 10 láº§n trá»Ÿ lÃªn (hiáº¿m cÃ³ >50).

      * Má»™t vÃ i giÃ¡ trá»‹ lá»›n (outlier) váº«n tá»“n táº¡i.

  - **Káº¿t luáº­n:**
  
      * Pháº§n lá»›n khÃ¡ch hÃ ng khÃ´ng trung thÃ nh â†’ chá»‰ mua 1 láº§n.

      * Ráº¥t cáº§n phÃ¡t triá»ƒn nhÃ³m khÃ¡ch â€œfrequent buyersâ€ (náº¿u muá»‘n tÄƒng CLV).

      * CÃ³ thá»ƒ táº¡o chÃ­nh sÃ¡ch Æ°u Ä‘Ã£i táº§n suáº¥t cho nhÃ³m tiá»m nÄƒng.

  - **Recency Distribution (Khoáº£ng thá»i gian ká»ƒ tá»« láº§n mua gáº§n nháº¥t):**

      * PhÃ¢n bá»‘ cÅ©ng lá»‡ch pháº£i nhÆ°ng nháº¹ hÆ¡n.

      * Nhiá»u khÃ¡ch hÃ ng má»›i mua gáº§n Ä‘Ã¢y (Recency tháº¥p) â†’ táº­p trung á»Ÿ khoáº£ng 0â€“50 ngÃ y.

      * CÃ ng xa (Recency cao), sá»‘ lÆ°á»£ng khÃ¡ch giáº£m dáº§n â†’ biá»ƒu hiá»‡n tá»‘t.

  - **Káº¿t luáº­n:**
  
      * CÃ³ nhiá»u khÃ¡ch hÃ ng má»›i hoáº¡t Ä‘á»™ng gáº§n Ä‘Ã¢y.

      * CÆ¡ há»™i ráº¥t tá»‘t Ä‘á»ƒ cháº¡y láº¡i remarketing hoáº·c tÃ¡i kÃ­ch hoáº¡t khÃ¡ch cÅ©.

      * Táº­p khÃ¡ch cÅ© (Recency > 250) cÃ³ thá»ƒ lÃ  khÃ¡ch rá»i bá».
      
**kiá»ƒm tra outlier**

```{r}
data_outliers <- aggregated_df
```

```{r}
# Äáº·t layout: 1 hÃ ng, 3 biá»ƒu Ä‘á»“
par(mfrow = c(1, 3), mar = c(4, 4, 3, 1))

# Boxplot 1: MonetaryValue
boxplot(aggregated_df$MonetaryValue,
        col = "skyblue",
        main = "Monetary Value Boxplot",
        xlab = "Monetary Value")

# Boxplot 2: Frequency
boxplot(aggregated_df$Frequency,
        col = "lightgreen",
        main = "Frequency Boxplot",
        xlab = "Frequency")

# Boxplot 3: Recency
boxplot(aggregated_df$Recency,
        col = "salmon",
        main = "Recency Boxplot",
        xlab = "Recency")

# Reset láº¡i layout vá» máº·c Ä‘á»‹nh (1 biá»ƒu Ä‘á»“)
par(mfrow = c(1, 1))
```


```{r}
# TÃ­nh Q1, Q3 vÃ  IQR cho MonetaryValue
M_Q1 <- quantile(aggregated_df$MonetaryValue, 0.25)
M_Q3 <- quantile(aggregated_df$MonetaryValue, 0.75)
M_IQR <- M_Q3 - M_Q1

# Lá»c cÃ¡c dÃ²ng lÃ  outlier
monetary_outliers_df <- aggregated_df[
  aggregated_df$MonetaryValue < (M_Q1 - 1.5 * M_IQR) |
  aggregated_df$MonetaryValue > (M_Q3 + 1.5 * M_IQR),
]

# Xem mÃ´ táº£ dá»¯ liá»‡u outlier
summary(monetary_outliers_df)

```

```{r}
# TÃ­nh Q1, Q3 vÃ  IQR cho Frequency
F_Q1 <- quantile(aggregated_df$Frequency, 0.25)
F_Q3 <- quantile(aggregated_df$Frequency, 0.75)
F_IQR <- F_Q3 - F_Q1

# Lá»c cÃ¡c dÃ²ng lÃ  outlier theo Frequency
frequency_outliers_df <- aggregated_df[
  aggregated_df$Frequency < (F_Q1 - 1.5 * F_IQR) |
  aggregated_df$Frequency > (F_Q3 + 1.5 * F_IQR),
]

# Thá»‘ng kÃª dá»¯ liá»‡u outlier
summary(frequency_outliers_df)

```

```{r}
# Loáº¡i bá» outlier báº±ng cÃ¡ch giá»¯ láº¡i cÃ¡c dÃ²ng KHÃ”NG náº±m trong monetary vÃ  frequency outliers

# Láº¥y chá»‰ sá»‘ hÃ ng (index) cáº§n loáº¡i bá»
outlier_indices <- union(
  which(aggregated_df$MonetaryValue < (M_Q1 - 1.5 * M_IQR) | aggregated_df$MonetaryValue > (M_Q3 + 1.5 * M_IQR)),
  which(aggregated_df$Frequency < (F_Q1 - 1.5 * F_IQR) | aggregated_df$Frequency > (F_Q3 + 1.5 * F_IQR))
)

# Giá»¯ láº¡i cÃ¡c dÃ²ng khÃ´ng náº±m trong chá»‰ sá»‘ outlier
non_outliers_df <- aggregated_df[-outlier_indices, ]

# Kiá»ƒm tra láº¡i
summary(non_outliers_df)

```


```{r}
# Trá»±c quan sau khi loáº¡i bá» 
# Chia khung hÃ¬nh ra 1 dÃ²ng 3 biá»ƒu Ä‘á»“
par(mfrow = c(1, 3), mar = c(4, 4, 3, 1))

# Boxplot 1: Monetary Value
boxplot(non_outliers_df$MonetaryValue,
        col = "skyblue",
        main = "Monetary Value Boxplot",
        xlab = "Monetary Value")

# Boxplot 2: Frequency
boxplot(non_outliers_df$Frequency,
        col = "lightgreen",
        main = "Frequency Boxplot",
        xlab = "Frequency")

# Boxplot 3: Recency
boxplot(non_outliers_df$Recency,
        col = "salmon",
        main = "Recency Boxplot",
        xlab = "Recency")

# Reset láº¡i layout vá» máº·c Ä‘á»‹nh
par(mfrow = c(1, 1))
```


```{r}
# Váº½ scatter plot 3D
plot_ly(non_outliers_df,
        x = ~MonetaryValue,
        y = ~Frequency,
        z = ~Recency,
        type = 'scatter3d',
        mode = 'markers',
        marker = list(size = 2, color = 'blue')) %>%
  layout(
    title = list(text = "3D Scatter Plot of Customer Data"),
    scene = list(
      xaxis = list(title = "Monetary"),
      yaxis = list(title = "Frequency"),
      zaxis = list(title = "Recency")
    )
  )

```
```{r}
# Chuáº©n hÃ³a cÃ¡c cá»™t MonetaryValue, Frequency, Recency
scaled_data <- scale(non_outliers_df[, c("MonetaryValue", "Frequency", "Recency")])
```

```{r}
# Chuyá»ƒn matrix chuáº©n hÃ³a vá» data.frame
scaled_data_df <- as.data.frame(scaled_data)

# Äáº·t láº¡i tÃªn cá»™t
colnames(scaled_data_df) <- c("MonetaryValue", "Frequency", "Recency")

# GÃ¡n láº¡i rownames náº¿u cáº§n giá»¯ index
rownames(scaled_data_df) <- rownames(non_outliers_df)
# Xem káº¿t quáº£
head(scaled_data_df)
```

```{r}
plot_ly(scaled_data_df,
        x = ~MonetaryValue,
        y = ~Frequency,
        z = ~Recency,
        type = "scatter3d",
        mode = "markers",
        marker = list(size = 2, color = 'blue')) %>%
  layout(title = "3D Scatter Plot of Scaled Customer Data")
```

# K-MEANS

```{r}

# Thiáº¿t láº­p
max_k <- 15
k_values <- 2:max_k

inertia <- numeric(length(k_values))
silhouette_scores <- numeric(length(k_values))

for (i in seq_along(k_values)) {
  k <- k_values[i]
  set.seed(42)
  kmeans_model <- kmeans(scaled_data_df, centers = k, nstart = 25, iter.max = 1000)

  # inertia
  inertia[i] <- kmeans_model$tot.withinss

  # silhouette
  sil <- silhouette(kmeans_model$cluster, dist(scaled_data_df))
  silhouette_scores[i] <- mean(sil[, 3])
}

# Táº¡o dataframe cho ggplot
plot_df <- data.frame(
  k = k_values,
  Inertia = inertia,
  Silhouette = silhouette_scores
)

# Biá»ƒu Ä‘á»“ Elbow
p1 <- ggplot(plot_df, aes(x = k, y = Inertia)) +
  geom_line() +
  geom_point() +
  labs(title = "KMeans Inertia for Different Values of k",
       x = "Number of Clusters (k)", y = "Inertia") +
  theme_minimal() +
  scale_x_continuous(breaks = k_values)

# Biá»ƒu Ä‘á»“ Silhouette
p2 <- ggplot(plot_df, aes(x = k, y = Silhouette)) +
  geom_line(color = "orange") +
  geom_point(color = "orange") +
  labs(title = "Silhouette Scores for Different Values of k",
       x = "Number of Clusters (k)", y = "Silhouette Score") +
  theme_minimal() +
  scale_x_continuous(breaks = k_values)

# Hiá»ƒn thá»‹ cáº£ hai biá»ƒu Ä‘á»“ cáº¡nh nhau
grid.arrange(p1, p2, ncol = 2)

```

**Nháº­n xÃ©t:**

  - **Biá»ƒu Ä‘á»“ bÃªn trÃ¡i â€“ Elbow Method (Inertia):**
  
      * GiÃ¡ trá»‹ Inertia giáº£m máº¡nh tá»« k = 2 Ä‘áº¿n k = 4, sau Ä‘Ã³ báº¯t Ä‘áº§u giáº£m cháº­m láº¡i
      táº¡o thÃ nh má»™t â€œkhuá»·u tayâ€ táº¡i k = 4.

      * ÄÃ¢y lÃ  dáº¥u hiá»‡u rÃµ rÃ ng cá»§a sá»‘ cá»¥m tá»‘i Æ°u, vÃ¬ táº¡i Ä‘iá»ƒm nÃ y mÃ´ hÃ¬nh Ä‘Ã£ gom        Ä‘Æ°á»£c pháº§n lá»›n thÃ´ng tin phÃ¢n tÃ¡n vÃ  viá»‡c tÄƒng thÃªm cá»¥m sau Ä‘Ã³ khÃ´ng lÃ m giáº£m       Inertia Ä‘Ã¡ng ká»ƒ ná»¯a.
    
  - **Biá»ƒu Ä‘á»“ bÃªn pháº£i â€“ Silhouette Score:**
    
      * Silhouette Ä‘áº¡t giÃ¡ trá»‹ cao nháº¥t á»Ÿ k = 2 vÃ  k = 3 (~0.45), sau Ä‘Ã³ giáº£m dáº§n.

      * Tuy nhiÃªn, k = 4 váº«n duy trÃ¬ má»©c Silhouette há»£p lÃ½ (~0.40), cho tháº¥y phÃ¢n        cá»¥m váº«n Ä‘á»§ rÃµ nÃ©t mÃ  khÃ´ng quÃ¡ Ä‘Æ¡n giáº£n.

      * Viá»‡c chá»n k = 4 lÃ  sá»± cÃ¢n báº±ng giá»¯a Ä‘á»™ rÃµ rÃ ng vÃ  Ä‘á»™ chi tiáº¿t cá»§a cÃ¡c cá»¥m        khÃ¡ch hÃ ng.
      
**Káº¿t luáº­n:**

Dá»±a trÃªn cáº£ hai biá»ƒu Ä‘á»“, sá»‘ lÆ°á»£ng cá»¥m tá»‘i Æ°u Ä‘Æ°á»£c lá»±a chá»n lÃ  k = 4. ÄÃ¢y lÃ  lá»±a chá»n há»£p lÃ½ Ä‘á»ƒ tiáº¿n hÃ nh phÃ¢n cá»¥m K-Means trong bÆ°á»›c tiáº¿p theo, vá»«a Ä‘áº£m báº£o tÃ­nh phÃ¢n biá»‡t giá»¯a cÃ¡c cá»¥m, vá»«a trÃ¡nh tÃ¬nh tráº¡ng quÃ¡ phÃ¢n máº£nh hoáº·c Ä‘Æ¡n giáº£n hÃ³a mÃ´ hÃ¬nh.

```{r}
library(scatterplot3d)  # váº½ 3D scatter

# Huáº¥n luyá»‡n mÃ´ hÃ¬nh KMeans
set.seed(42)
kmeans_model <- kmeans(scaled_data_df, centers = 4, nstart = 25, iter.max = 1000)

# GÃ¡n nhÃ£n cá»¥m vÃ o non_outliers_df
non_outliers_df$Cluster <- kmeans_model$cluster

# MÃ u thá»§ cÃ´ng cho tá»«ng cá»¥m
cluster_colors <- c("#1f77b4", "#ff7f0e", "#2ca02c", "#d62728")
color_map <- cluster_colors[non_outliers_df$Cluster]

plot_ly(non_outliers_df, 
        x = ~MonetaryValue, 
        y = ~Frequency, 
        z = ~Recency, 
        color = ~factor(Cluster),
        colors = cluster_colors,
        type = 'scatter3d',
        mode = 'markers',
        marker = list(size = 2)) %>%  
  layout(title = "3D Scatter Plot of Customer Data by Cluster")

```

**Nháº­n xÃ©t:**

Biá»ƒu Ä‘á»“ 3D thá»ƒ hiá»‡n sá»± phÃ¢n bá»‘ cá»§a cÃ¡c khÃ¡ch hÃ ng theo 3 chiá»u **Recency**, **Frequency**, vÃ  **MonetaryValue**, Ä‘Æ°á»£c phÃ¢n cá»¥m báº±ng thuáº­t toÃ¡n K-Means vá»›i sá»‘ cá»¥m k = 4.

- NhÃ¬n chung, cÃ¡c cá»¥m Ä‘Æ°á»£c tÃ¡ch biá»‡t tÆ°Æ¡ng Ä‘á»‘i rÃµ, Ä‘áº·c biá»‡t lÃ  theo trá»¥c Monetary vÃ  Frequency.

- **Cá»¥m mÃ u Ä‘á»** (Cluster 4) táº­p trung á»Ÿ vÃ¹ng Recency cao, Frequency tháº¥p, Monetary tháº¥p -> ÄÃ¢y cÃ³ thá»ƒ lÃ  nhÃ³m khÃ¡ch hÃ ng khÃ´ng cÃ²n mua hÃ ng gáº§n Ä‘Ã¢y vÃ  giÃ¡ trá»‹ tháº¥p.

- **Cá»¥m mÃ u xanh lam** (Cluster 1) náº±m á»Ÿ Ä‘Ã¡y biá»ƒu Ä‘á»“, vá»›i Recency tháº¥p, Frequency cao vÃ  Monetary ráº¥t cao â†’ nhÃ³m khÃ¡ch hÃ ng trung thÃ nh vÃ  cÃ³ giÃ¡ trá»‹ lá»›n.

- CÃ¡c cá»¥m cÃ²n láº¡i náº±m xen giá»¯a, cho tháº¥y cÃ¡c nhÃ³m khÃ¡ch hÃ ng cÃ³ hÃ nh vi mua hÃ ng trung bÃ¬nh hoáº·c khÃ´ng Ä‘á»u Ä‘áº·n.

**Ã nghÄ©a:**

  - Viá»‡c trá»±c quan hÃ³a dá»¯ liá»‡u RFM theo khÃ´ng gian 3 chiá»u giÃºp kiá»ƒm chá»©ng láº¡i hiá»‡u   quáº£ phÃ¢n cá»¥m.

  - Doanh nghiá»‡p cÃ³ thá»ƒ dá»… dÃ ng xÃ¡c Ä‘á»‹nh nhÃ³m khÃ¡ch hÃ ng tiá»m nÄƒng Ä‘á»ƒ duy trÃ¬ vÃ    nhÃ³m khÃ´ng hiá»‡u quáº£ Ä‘á»ƒ tiáº¿t giáº£m chi phÃ­ tiáº¿p thá»‹.

  - ÄÃ¢y lÃ  bÆ°á»›c quan trá»ng trong cÃ¡c chiáº¿n lÆ°á»£c **phÃ¢n khÃºc thá»‹ trÆ°á»ng** vÃ  **giá»¯   chÃ¢n khÃ¡ch hÃ ng**.


```{r}
# Äáº£m báº£o Cluster lÃ  factor
non_outliers_df$Cluster <- as.factor(non_outliers_df$Cluster)

# Táº¡o báº£ng mÃ u tÆ°Æ¡ng á»©ng nhÆ° Python
cluster_colors <- c("0" = "#1f77b4", "1" = "#ff7f0e", "2" = "#2ca02c", "3" = "#d62728")

# Violin plot cho Recency
ggplot(non_outliers_df, aes(x = Cluster, y = Recency, fill = Cluster)) +
  geom_violin(trim = FALSE) +
  geom_boxplot(width = 0.1, color = "black", fill = "white") +
  labs(title = "PhÃ¢n bá»‘ Recency theo cá»¥m", y = "Recency") +
  theme_minimal()

# Violin plot cho Frequency
ggplot(non_outliers_df, aes(x = Cluster, y = Frequency, fill = Cluster)) +
  geom_violin(trim = FALSE) +
  geom_boxplot(width = 0.1, color = "black", fill = "white") +
  labs(title = "PhÃ¢n bá»‘ Frequency theo cá»¥m", y = "Frequency") +
  theme_minimal()

# TÆ°Æ¡ng tá»± cho Monetary
ggplot(non_outliers_df, aes(x = Cluster, y = MonetaryValue, fill = Cluster)) +
  geom_violin(trim = FALSE) +
  geom_boxplot(width = 0.1, color = "black", fill = "white") +
  labs(title = "PhÃ¢n bá»‘ Monetary theo cá»¥m", y = "Monetary Value") +
  theme_minimal()
```

**Nháº­n xÃ©t: PhÃ¢n bá»‘ Recency**

  * Cá»¥m 1 (mÃ u Ä‘á»): CÃ³ giÃ¡ trá»‹ Recency ráº¥t tháº¥p, phÃ¢n bá»‘ táº­p trung quanh 10â€“30       ngÃ y, cho tháº¥y Ä‘Ã¢y lÃ  nhÃ³m khÃ¡ch hÃ ng vá»«a má»›i mua hÃ ng gáº§n Ä‘Ã¢y nháº¥t -> nhÃ³m
  ráº¥t tiá»m nÄƒng cáº§n Ä‘Æ°á»£c giá»¯ chÃ¢n.
      
  * Cá»¥m 2 (mÃ u xanh lÃ¡): Recency tráº£i rá»™ng tá»« tháº¥p Ä‘áº¿n khoáº£ng 100 ngÃ y, nhÆ°ng        pháº§n lá»›n táº­p trung dÆ°á»›i 50 -> nhÃ³m khÃ¡ch hÃ ng cÃ³ mua gáº§n Ä‘Ã¢y, nhÆ°ng khÃ´ng Ä‘á»u
  Ä‘áº·n báº±ng cá»¥m 1.

  * Cá»¥m 3 (mÃ u xanh dÆ°Æ¡ng): TÆ°Æ¡ng tá»± cá»¥m 1, nhÆ°ng phÃ¢n bá»‘ hÆ¡i rá»™ng hÆ¡n -> váº«n        lÃ  khÃ¡ch hÃ ng má»›i tÆ°Æ¡ng tÃ¡c gáº§n Ä‘Ã¢y, cÃ³ kháº£ nÄƒng mua láº¡i náº¿u chÄƒm sÃ³c tá»‘t.

  * Cá»¥m 4 (mÃ u tÃ­m): CÃ³ Recency ráº¥t cao, pháº§n lá»›n náº±m quanh 200â€“350 ngÃ y -> Ä‘Ã¢y      lÃ  nhÃ³m khÃ¡ch hÃ ng Ä‘Ã£ lÃ¢u khÃ´ng quay láº¡i, cÃ³ nguy cÆ¡ rá»i bá» thÆ°Æ¡ng hiá»‡u, cáº§n       cÃ³ chÃ­nh sÃ¡ch tÃ¡i tiáº¿p cáº­n hoáº·c remarketing.
      
**Ã nghÄ©a:**
  
  - Biá»ƒu Ä‘á»“ nÃ y giÃºp xÃ¡c Ä‘á»‹nh má»©c Ä‘á»™ â€œgáº§n Ä‘Ã¢yâ€ cá»§a cÃ¡c giao dá»‹ch theo tá»«ng nhÃ³m        khÃ¡ch hÃ ng. Qua Ä‘Ã³:

    * Cá»¥m 1 & 3 -> nÃªn Æ°u tiÃªn chÄƒm sÃ³c, upsell hoáº·c táº·ng Æ°u Ä‘Ã£i Ä‘áº·c biá»‡t.

    * Cá»¥m 4 -> cáº§n cÃ³ chiáº¿n dá»‹ch tÃ¡i tÆ°Æ¡ng tÃ¡c, khuyáº¿n mÃ£i â€œquay láº¡iâ€, email            marketing hoáº·c táº·ng mÃ£ giáº£m giÃ¡.

    * PhÃ¢n tÃ­ch Recency Ä‘Ã³ng vai trÃ² quan trá»ng trong viá»‡c dá»± Ä‘oÃ¡n hÃ nh vi mua         hÃ ng sáº¯p tá»›i.

**Nháº­n xÃ©t: PhÃ¢n bá»‘ Frequency:**

  * Cá»¥m 1 (mÃ u Ä‘á»): CÃ³ giÃ¡ trá»‹ Frequency cao nháº¥t trong cÃ¡c cá»¥m, pháº§n lá»›n dao Ä‘á»™ng
  tá»« 6 Ä‘áº¿n 9, tháº­m chÃ­ cÃ³ Ä‘iá»ƒm lÃªn Ä‘áº¿n 12.

  * ÄÃ¢y lÃ  nhÃ³m mua hÃ ng nhiá»u láº§n, thÆ°á»ng xuyÃªn quay láº¡i -> nhÃ³m trung thÃ nh, cÃ³
  má»©c Ä‘á»™ gáº¯n káº¿t cao vá»›i doanh nghiá»‡p.

  * Cá»¥m 2 (mÃ u xanh lÃ¡): Táº§n suáº¥t mua hÃ ng tháº¥p, háº§u háº¿t dao Ä‘á»™ng trong khoáº£ng 1
  Ä‘áº¿n 3 láº§n.

  * NhÃ³m nÃ y cÃ³ thá»ƒ lÃ  khÃ¡ch hÃ ng mua thá»­, hoáº·c chá»‰ tÆ°Æ¡ng tÃ¡c ngáº¯n háº¡n -> cáº§n Ä‘Æ°á»£c
  kÃ­ch thÃ­ch mua láº¡i.

  * Cá»¥m 3 (mÃ u xanh dÆ°Æ¡ng): CÃ³ Frequency á»Ÿ má»©c trung bÃ¬nh, phá»• biáº¿n trong khoáº£ng
  3â€“6 láº§n.

  * ÄÃ¢y lÃ  nhÃ³m tiá»m nÄƒng â€“ chÆ°a thá»±c sá»± trung thÃ nh, nhÆ°ng cÃ³ dáº¥u hiá»‡u mua láº·p láº¡i
  -> nÃªn Ä‘Æ°á»£c nuÃ´i dÆ°á»¡ng.

  * Cá»¥m 4 (mÃ u tÃ­m): CÃ³ Frequency ráº¥t tháº¥p, pháº§n lá»›n chá»‰ 1â€“2 láº§n mua.

  * Káº¿t há»£p vá»›i Recency cao (tá»« biá»ƒu Ä‘á»“ trÆ°á»›c) -> cÃ³ kháº£ nÄƒng lÃ  nhÃ³m mua má»™t láº§n
  rá»“i rá»i bá», Ã­t giÃ¡ trá»‹.
  
**Ã nghÄ©a:**

  - Biá»ƒu Ä‘á»“ giÃºp doanh nghiá»‡p dá»… dÃ ng nháº­n biáº¿t nhÃ³m khÃ¡ch nÃ o cÃ³ hÃ nh vi mua láº·p
  láº¡i cao Ä‘á»ƒ táº­p trung chÄƒm sÃ³c vÃ  giá»¯ chÃ¢n.

  - CÃ¡c cá»¥m cÃ³ Frequency tháº¥p nhÆ°ng Recency cÅ©ng tháº¥p (nhÆ° cá»¥m 2) â†’ cÃ³ thá»ƒ váº«n cÃ²n
  cÆ¡ há»™i chuyá»ƒn hÃ³a náº¿u tiáº¿p thá»‹ Ä‘Ãºng lÃºc.

  - Káº¿t há»£p phÃ¢n tÃ­ch Frequency vá»›i Recency sáº½ giÃºp xÃ¡c Ä‘á»‹nh tá»‡p khÃ¡ch hÃ ng trung
  thÃ nh vs khÃ¡ch â€œmá»™t láº§n rá»“i thÃ´iâ€, tá»« Ä‘Ã³ ra quyáº¿t Ä‘á»‹nh marketing hiá»‡u quáº£ hÆ¡n.

**Nháº­n xÃ©t: PhÃ¢n bá»‘ Monetary:**

  * Cá»¥m 1 (mÃ u Ä‘á»): ÄÃ¢y lÃ  nhÃ³m cÃ³ giÃ¡ trá»‹ Monetary cao nháº¥t, pháº§n lá»›n dao Ä‘á»™ng tá»«
  2.000 Ä‘áº¿n gáº§n 4.000.

  * ÄÃ¢y cháº¯c cháº¯n lÃ  nhÃ³m khÃ¡ch hÃ ng cÃ³ giÃ¡ trá»‹ lá»›n nháº¥t, thÆ°á»ng xuyÃªn chi tiÃªu
  cao, Ä‘Ã³ng gÃ³p nhiá»u cho doanh thu -> nhÃ³m VIP hoáº·c khÃ¡ch hÃ ng trung thÃ nh nháº¥t.

  * Cá»¥m 2 (mÃ u xanh lÃ¡): Monetary ráº¥t tháº¥p, pháº§n lá»›n chá»‰ á»Ÿ má»©c 200 â€“ 600.

  * ÄÃ¢y cÃ³ thá»ƒ lÃ  nhÃ³m khÃ¡ch Ã­t mua vÃ  mua vá»›i giÃ¡ trá»‹ tháº¥p, cÃ³ thá»ƒ lÃ  khÃ¡ch vÃ£ng
  lai hoáº·c má»›i mua thá»­.

  * Cá»¥m 3 (mÃ u xanh dÆ°Æ¡ng): CÃ³ má»©c chi tiÃªu á»Ÿ má»©c trung bÃ¬nh khÃ¡, tráº£i rá»™ng tá»«
  khoáº£ng 800 â€“ 2500, má»™t sá»‘ Ä‘iá»ƒm cÃ²n lÃªn cao hÆ¡n.

  * ÄÃ¢y lÃ  nhÃ³m khÃ¡ch cÃ³ tiá»m nÄƒng, náº¿u Ä‘Æ°á»£c thÃºc Ä‘áº©y Ä‘Ãºng cÃ¡ch cÃ³ thá»ƒ chuyá»ƒn hÃ³a
  thÃ nh khÃ¡ch hÃ ng trung thÃ nh.

  * Cá»¥m 4 (mÃ u tÃ­m):
  CÃ³ giÃ¡ trá»‹ Monetary tháº¥p nháº¥t trong táº¥t cáº£ cÃ¡c cá»¥m, pháº§n lá»›n dao Ä‘á»™ng tá»« dÆ°á»›i 500
  Ä‘áº¿n khoáº£ng 800.

  * Káº¿t há»£p vá»›i Recency cao vÃ  Frequency tháº¥p -> nhÃ³m Ä‘Ã£ lÃ¢u khÃ´ng quay láº¡i, mua
  Ã­t, khÃ´ng thu lá»£i cao.
  
**Ã nghÄ©a:**

  - Biá»ƒu Ä‘á»“ Monetary giÃºp doanh nghiá»‡p xÃ¡c Ä‘á»‹nh giÃ¡ trá»‹ tÃ i chÃ­nh cá»§a tá»«ng nhÃ³m
  khÃ¡ch hÃ ng.
  
  - Cá»¥m 1 nÃªn Ä‘Æ°á»£c xem lÃ  tá»‡p khÃ¡ch hÃ ng Æ°u tiÃªn cao nháº¥t, cÃ³ thá»ƒ Ã¡p dá»¥ng chiáº¿n
  lÆ°á»£c chÄƒm sÃ³c Ä‘áº·c biá»‡t nhÆ° VIP member, tháº» tÃ­ch Ä‘iá»ƒm, quÃ  táº·ng cÃ¡ nhÃ¢n,...

  - Cá»¥m 3 lÃ  nhÃ³m cÃ³ kháº£ nÄƒng phÃ¡t triá»ƒn, náº¿u Ä‘Æ°á»£c tiáº¿p thá»‹ vÃ  chÄƒm sÃ³c há»£p lÃ½.

  - cá»¥m 4 nÃªn Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ láº¡i chi phÃ­ giá»¯ chÃ¢n Ä‘á»ƒ trÃ¡nh lÃ£ng phÃ­ nguá»“n lá»±c.

**Káº¿t luáº­n:**

Sau khi phÃ¢n tÃ­ch trá»±c quan tá»«ng thÃ nh pháº§n cá»§a mÃ´ hÃ¬nh RFM theo tá»«ng cá»¥m khÃ¡ch hÃ ng, cÃ³ thá»ƒ rÃºt ra cÃ¡c nháº­n Ä‘á»‹nh quan trá»ng nhÆ° sau:

- Cá»¥m 1 (mÃ u Ä‘á»):
  * ÄÃ¢y lÃ  nhÃ³m khÃ¡ch hÃ ng tá»‘t nháº¥t:

  * Mua gáº§n Ä‘Ã¢y (Recency tháº¥p),

  * Mua nhiá»u láº§n (Frequency cao),

  * Chi tiÃªu lá»›n (Monetary cao).
  
-> ÄÃ¢y lÃ  nhÃ³m khÃ¡ch hÃ ng trung thÃ nh, cÃ³ giÃ¡ trá»‹ cao, cáº§n Ä‘Æ°á»£c Æ°u tiÃªn chÄƒm sÃ³c, giá»¯ chÃ¢n vÃ  táº¡o cÃ¡c chÆ°Æ¡ng trÃ¬nh khuyáº¿n khÃ­ch tÃ¡i mua.

- Cá»¥m 2 (mÃ u xanh lÃ¡):

  * CÃ³ táº§n suáº¥t mua tháº¥p, giÃ¡ trá»‹ Ä‘Æ¡n hÃ ng nhá» vÃ  thá»i gian mua gáº§n Ä‘Ã¢y tÆ°Æ¡ng Ä‘á»‘i
  á»•n.
  
-> NhÃ³m má»›i báº¯t Ä‘áº§u tÆ°Æ¡ng tÃ¡c hoáº·c khÃ¡ch hÃ ng mua thá»­. Doanh nghiá»‡p cÃ³ thá»ƒ táº­p trung nuÃ´i dÆ°á»¡ng nhÃ³m nÃ y báº±ng chÆ°Æ¡ng trÃ¬nh chÄƒm sÃ³c khuyáº¿n mÃ£i, Æ°u Ä‘Ã£i.

- Cá»¥m 3 (mÃ u xanh dÆ°Æ¡ng):

  * Mua khÃ´ng quÃ¡ thÆ°á»ng xuyÃªn nhÆ°ng cÃ³ chi tiÃªu trung bÃ¬nh khÃ¡ vÃ  mua tÆ°Æ¡ng Ä‘á»‘i
  gáº§n Ä‘Ã¢y.
  
-> LÃ  nhÃ³m khÃ¡ch hÃ ng tiá»m nÄƒng, cÃ³ thá»ƒ trá»Ÿ thÃ nh trung thÃ nh náº¿u Ä‘Æ°á»£c chÄƒm sÃ³c vÃ  cÃ³ cÃ¡c chiáº¿n lÆ°á»£c tiáº¿p thá»‹ phÃ¹ há»£p.

- Cá»¥m 4 (mÃ u tÃ­m):

  * Giao dá»‹ch Ä‘Ã£ lÃ¢u (Recency cao), táº§n suáº¥t mua ráº¥t tháº¥p vÃ  giÃ¡ trá»‹ chi tiÃªu nhá».
  
-> ÄÃ¢y lÃ  nhÃ³m khÃ¡ch hÃ ng khÃ´ng hoáº¡t Ä‘á»™ng, cÃ³ thá»ƒ Ä‘Ã£ rá»i bá» thÆ°Æ¡ng hiá»‡u. Cáº§n xem xÃ©t chiáº¿n lÆ°á»£c tiáº¿p cáº­n láº¡i hoáº·c loáº¡i khá»i cÃ¡c chiáº¿n dá»‹ch Æ°u tiÃªn Ä‘á»ƒ tiáº¿t kiá»‡m nguá»“n lá»±c.

```{r}
table(non_outliers_df$Cluster) #Sá»‘ lÆ°á»£ng khÃ¡ch hÃ ng tá»«ng cá»¥m
```

```{r}
# TÃ¬m chá»‰ sá»‘ giao nhau giá»¯a 2 táº­p outliers
overlap_indices <- intersect(rownames(monetary_outliers_df), rownames(frequency_outliers_df))

# Táº¡o táº­p chá»‰ lÃ  Monetary outliers
monetary_only_outliers <- monetary_outliers_df[!rownames(monetary_outliers_df) %in% overlap_indices, ]
monetary_only_outliers$Cluster <- -1

# Táº¡o táº­p chá»‰ lÃ  Frequency outliers
frequency_only_outliers <- frequency_outliers_df[!rownames(frequency_outliers_df) %in% overlap_indices, ]
frequency_only_outliers$Cluster <- -2

# Táº¡o táº­p lÃ  outliers cá»§a cáº£ hai
monetary_and_frequency_outliers <- monetary_outliers_df[rownames(monetary_outliers_df) %in% overlap_indices, ]
monetary_and_frequency_outliers$Cluster <- -3

# Gá»™p táº¥t cáº£ láº¡i
outlier_clusters_df <- rbind(
  monetary_only_outliers,
  frequency_only_outliers,
  monetary_and_frequency_outliers
)

# Káº¿t quáº£
head(outlier_clusters_df)

```

```{r}
# Kiá»ƒm tra
table(outlier_clusters_df$Cluster)
```


```{r}
# Chuyá»ƒn Cluster thÃ nh factor Ä‘á»ƒ dá»… gÃ¡n mÃ u
outlier_clusters_df$Cluster <- factor(outlier_clusters_df$Cluster)

# Táº¡o báº£ng mÃ u tÆ°Æ¡ng Ä‘Æ°Æ¡ng cluster_colors
cluster_colors <- c("-1" = "#9467bd", "-2" = "#8c564b", "-3" = "#e377c2")

# Violin plot: MonetaryValue
ggplot(outlier_clusters_df, aes(x = Cluster, y = MonetaryValue, fill = Cluster)) +
  geom_violin(trim = FALSE) +
  scale_fill_manual(values = cluster_colors) +
  labs(title = "Monetary Value by Cluster", y = "Monetary Value") +
  theme_minimal()

# Violin plot: Frequency
ggplot(outlier_clusters_df, aes(x = Cluster, y = Frequency, fill = Cluster)) +
  geom_violin(trim = FALSE) +
  scale_fill_manual(values = cluster_colors) +
  labs(title = "Frequency by Cluster", y = "Frequency") +
  theme_minimal()

# Violin plot: Recency
ggplot(outlier_clusters_df, aes(x = Cluster, y = Recency, fill = Cluster)) +
  geom_violin(trim = FALSE) +
  scale_fill_manual(values = cluster_colors) +
  labs(title = "Recency by Cluster", y = "Recency") +
  theme_minimal()

```
**Nháº­n xÃ©t: Recency cá»§a cÃ¡c nhÃ³m Outliers:**

  - Cáº£ hai cá»¥m Ä‘á»u cÃ³ giÃ¡ trá»‹ Recency tháº¥p, tá»©c lÃ  pháº§n lá»›n khÃ¡ch hÃ ng trong hai
  nhÃ³m nÃ y mua hÃ ng gáº§n Ä‘Ã¢y, thÆ°á»ng xuyÃªn quay láº¡i trong thá»i gian gáº§n phÃ¢n tÃ­ch
  (Recency ~ 0â€“50 ngÃ y lÃ  phá»• biáº¿n).

  - Cluster -3: Recency phÃ¢n bá»‘ cá»±c tháº¥p vÃ  nghiÃªng vá» phÃ­a 0 -> nhá»¯ng khÃ¡ch hÃ ng
  gáº§n nhÆ° vá»«a má»›i mua hÃ ng, káº¿t há»£p vá»›i táº§n suáº¥t cao vÃ  chi tiÃªu lá»›n -> Ä‘Ã¢y lÃ  tá»‡p
  khÃ¡ch hÃ ng siÃªu trung thÃ nh.

  - Cluster -1: CÅ©ng cÃ³ Recency khÃ¡ tháº¥p, nhÆ°ng phÃ¢n bá»‘ dÃ n rá»™ng hÆ¡n má»™t chÃºt ->
  má»™t sá»‘ khÃ¡ch tuy chi nhiá»u nhÆ°ng cÃ³ thá»ƒ Ä‘Ã£ khÃ´ng mua trong thá»i gian dÃ i.

**Ã nghÄ©a:**

  - Cluster -3: HoÃ n háº£o cho chÆ°Æ¡ng trÃ¬nh tri Ã¢n VIP hiá»‡n táº¡i.

  - Cluster -1: NÃªn Ä‘Æ°á»£c tiáº¿p cáº­n báº±ng chiáº¿n dá»‹ch kÃªu gá»i quay láº¡i nhÆ° Æ°u Ä‘Ã£i cho
  Ä‘Æ¡n hÃ ng tiáº¿p theo, voucher náº¿u mua láº¡i trong 7 ngÃ y,â€¦
  
**Nháº­n xÃ©t: Frequency cá»§a cÃ¡c nhÃ³m Outliers:**

  - Cluster -3: PhÃ¢n bá»‘ Frequency ráº¥t rá»™ng, cÃ³ nhiá»u Ä‘iá»ƒm lÃªn tá»›i trÃªn 200 lÆ°á»£t
  mua, pháº§n lá»›n táº­p trung tá»« 10â€“50 láº§n giao dá»‹ch.

  - ÄÃ¢y lÃ  nhÃ³m mua nhiá»u â€“ ráº¥t thÆ°á»ng xuyÃªn, káº¿t há»£p vá»›i giÃ¡ trá»‹ chi tiÃªu cao -> thá»ƒ hiá»‡n Ä‘áº·c trÆ°ng cá»§a khÃ¡ch hÃ ng trung thÃ nh lÃ¢u nÄƒm hoáº·c doanh nghiá»‡p mua sá»‰ Ä‘á»‹nh ká»³.

  - Cluster -1: Frequency tháº¥p hÆ¡n Ä‘Ã¡ng ká»ƒ, háº§u háº¿t khÃ¡ch hÃ ng chá»‰ mua khoáº£ng 5â€“20
  láº§n, ráº¥t Ã­t trÆ°á»ng há»£p vÆ°á»£t qua 50.

  - NhÃ³m nÃ y khÃ´ng mua thÆ°á»ng xuyÃªn, nhÆ°ng má»—i láº§n mua cÃ³ giÃ¡ trá»‹ cao -> kháº£ nÄƒng lÃ  khÃ¡ch mua Ã­t nhÆ°ng sáº£n pháº©m cÃ³ giÃ¡ trá»‹ lá»›n vÃ­ dá»¥: khÃ¡ch doanh nghiá»‡p, quÃ  táº·ng,...

**Ã nghÄ©a:**

  - Cluster -3 lÃ  nhÃ³m cá»±c ká»³ quan trá»ng Ä‘á»ƒ duy trÃ¬ lÃ¢u dÃ i. CÃ³ thá»ƒ Ã¡p dá»¥ng cÃ¡c chÆ°Æ¡ng trÃ¬nh nhÆ°:

    * Æ¯u Ä‘Ã£i theo cáº¥p báº­c (tÃ­ch Ä‘iá»ƒm)

    * Táº·ng thÃªm sáº£n pháº©m

    * Æ¯u tiÃªn há»— trá»£

  - Cluster -1 cÃ³ thá»ƒ kÃ­ch hoáº¡t tÄƒng táº§n suáº¥t mua báº±ng:

    * Gá»£i Ã½ sáº£n pháº©m liÃªn quan

    * Æ¯u Ä‘Ã£i cho Ä‘Æ¡n tiáº¿p theo trong thá»i gian ngáº¯n

    * Æ¯u Ä‘Ã£i combo/quÃ  táº·ng khi mua láº¡i trong 30 ngÃ y

**Nháº­n xÃ©t: Monetary cá»§a cÃ¡c nhÃ³m Outliers:**

  - Cáº£ hai cá»¥m Ä‘á»u cÃ³ Monetary Value ráº¥t cao, vá»›i má»™t sá»‘ khÃ¡ch hÃ ng tháº­m chÃ­ chi
  tiÃªu lÃªn tá»›i trÃªn 200.000 Ä‘Æ¡n vá»‹ tiá»n tá»‡ â€“ Ä‘Ã¢y lÃ  nhá»¯ng ngoáº¡i lá»‡ thá»±c sá»± trong
  táº­p khÃ¡ch hÃ ng.

  - Cluster -3:

    * Máº­t Ä‘á»™ phÃ¢n bá»‘ rá»™ng vÃ  dÃ y hÆ¡n quanh má»©c tá»« 0 Ä‘áº¿n 20.000, cho tháº¥y nhÃ³m nÃ y
    cÃ³ giÃ¡ trá»‹ Ä‘Æ¡n hÃ ng cao.

    * DÃ¹ cÃ³ nhiá»u Ä‘iá»ƒm outlier máº¡nh, nhÆ°ng pháº§n lá»›n khÃ¡ch váº«n táº­p trung á»Ÿ khoáº£ng tá»«
    5.000â€“10.000.

  - Cluster -1:

    * PhÃ¢n bá»‘ háº¹p hÆ¡n má»™t chÃºt so vá»›i cluster -3, nhÆ°ng váº«n cÃ³ má»™t vÃ i khÃ¡ch chi
    tiÃªu ráº¥t lá»›n.

    * Äáº·c trÆ°ng lÃ  mua Ã­t láº§n nhÆ°ng má»—i láº§n chi cá»±c nhiá»u (vÃ­ dá»¥ doanh nghiá»‡p,...).
    
**Ã nghÄ©a:**

  - Cluster -3: ÄÃ¢y lÃ  khÃ¡ch hÃ ng vÃ ng, ráº¥t trung thÃ nh vÃ  cÃ³ giÃ¡ trá»‹ lÃ¢u dÃ i ->
  xá»©ng Ä‘Ã¡ng nháº­n cÃ¡c Æ°u Ä‘Ã£i Ä‘áº·c biá»‡t.

  - Cluster -1: DÃ¹ khÃ´ng thÆ°á»ng xuyÃªn mua nhÆ°ng má»—i láº§n mua láº¡i chi tiÃªu cá»±c lá»›n ->
  nÃªn cÃ³ cÃ¡c chiáº¿n lÆ°á»£c khuyáº¿n khÃ­ch mua Ä‘á»‹nh ká»³, Æ°u Ä‘Ã£i Ä‘áº·c biá»‡t theo má»—i Ä‘Æ¡n lá»›n.

**Káº¿t luáº­n:**

Dá»±a trÃªn ba biá»ƒu Ä‘á»“ phÃ¢n tÃ­ch Recency â€“ Frequency â€“ Monetary Value, cÃ³ thá»ƒ Ä‘Æ°a ra káº¿t luáº­n sau:

  - Cluster -3 (cÃ³ cáº£ Outliers theo Monetary vÃ  Frequency cao):
  
    * LÃ  nhÃ³m khÃ¡ch hÃ ng vá»«a chi tiÃªu lá»›n, vá»«a mua thÆ°á»ng xuyÃªn, vÃ  pháº§n lá»›n Ä‘á»u cÃ³     Recency tháº¥p (mua gáº§n Ä‘Ã¢y).

    * CÃ³ giÃ¡ trá»‹ vÆ°á»£t trá»™i rÃµ rá»‡t trong cáº£ ba chiá»u -> nhÃ³m khÃ¡ch hÃ ng VIP,
    Ä‘Ã³ng vai trÃ² ráº¥t quan trá»ng vá»›i doanh thu.

  - Cluster -1 (chá»‰ outlier theo Monetary):
  
    * NhÃ³m khÃ¡ch hÃ ng mua khÃ´ng nhiá»u láº§n, nhÆ°ng má»—i láº§n Ä‘á»u chi ráº¥t máº¡nh tay.

    * Recency cÃ³ thá»ƒ khÃ´ng quÃ¡ tháº¥p -> má»™t sá»‘ khÃ¡ch Ä‘Ã£ lÃ¢u khÃ´ng quay láº¡i, cáº§n
    chiáº¿n lÆ°á»£c phÃ¹ há»£p.

    * PhÃ¹ há»£p vá»›i cÃ¡c chÆ°Æ¡ng trÃ¬nh Æ°u Ä‘Ã£i Ä‘Æ¡n hÃ ng lá»›n, táº·ng voucher cho láº§n mua
    tiáº¿p theo, hoáº·c chÄƒm sÃ³c cÃ¡ nhÃ¢n hoÃ¡ theo giÃ¡ trá»‹ giao dá»‹ch.


```{r}
# Táº¡o vector gÃ¡n nhÃ£n cluster
cluster_labels <- c(
  "0" = "RETAIN",       # Giá»¯ chÃ¢n khÃ¡ch hÃ ng hiá»‡n táº¡i
  "1" = "RE-ENGAGE",    # TÆ°Æ¡ng tÃ¡c láº¡i vá»›i khÃ¡ch hÃ ng Ä‘Ã£ rá»i Ä‘i
  "2" = "NURTURE",      # ChÄƒm sÃ³c khÃ¡ch hÃ ng tiá»m nÄƒng
  "3" = "REWARD",       # ThÆ°á»Ÿng cho khÃ¡ch hÃ ng trung thÃ nh
  "4" = "EXPLORE",      # NhÃ³m khÃ¡ch hÃ ng chÆ°a cÃ³ hÃ nh vi ná»•i báº­t rÃµ rÃ ng
  "-1" = "PAMPER",      # Chiá»u chuá»™ng khÃ¡ch hÃ ng VIP
  "-2" = "UPSELL",      # Äá» xuáº¥t mua thÃªm
  "-3" = "DELIGHT"      # Tráº£i nghiá»‡m xuáº¥t sáº¯c
)
```

```{r}
# Gá»™p 2 dataframe láº¡i theo hÃ ng (giá»‘ng pd.concat)
full_clustering_df <- rbind(non_outliers_df, outlier_clusters_df)
full_clustering_df$ClusterLabel <- cluster_labels[as.character(full_clustering_df$Cluster)]
# Xem káº¿t quáº£
head(full_clustering_df)

```

```{r}
# Kiá»ƒm tra sá»‘ hÃ ng
nrow(full_clustering_df)

# Kiá»ƒm tra cÃ¡c nhÃ³m trong Cluster
table(full_clustering_df$Cluster)

# Kiá»ƒm tra náº¿u cÃ³ cá»™t ClusterLabel Ä‘Ã£ gÃ¡n
table(full_clustering_df$ClusterLabel)

```

```{r}
# GÃ¡n nhÃ£n cá»¥m báº±ng named vector cluster_labels
full_clustering_df$ClusterLabel <- cluster_labels[as.character(full_clustering_df$Cluster)]

# Xem ngáº«u nhiÃªn 10 dÃ²ng
full_clustering_df[sample(nrow(full_clustering_df), 10), ]

```

```{r}
# TÃ­nh sá»‘ lÆ°á»£ng khÃ¡ch má»—i cá»¥m
cluster_counts <- full_clustering_df %>%
  count(ClusterLabel, name = "CustomerCount")
```

```{r}
# TÃ­nh trung bÃ¬nh cÃ¡c biáº¿n
feature_means <- full_clustering_df %>%
  mutate(MonetaryValuePer100 = MonetaryValue / 100) %>%
  group_by(ClusterLabel) %>%
  summarise(
    Recency = mean(Recency, na.rm = TRUE),
    Frequency = mean(Frequency, na.rm = TRUE),
    `MonetaryValue per 100` = mean(MonetaryValuePer100, na.rm = TRUE)
  ) %>%
  pivot_longer(cols = c("Recency", "Frequency", "MonetaryValue per 100"),
               names_to = "Feature", values_to = "MeanValue")
```

```{r}
# Merge láº¡i vÃ  sáº¯p xáº¿p giáº£m dáº§n theo CustomerCount
plot_df <- left_join(feature_means, cluster_counts, by = "ClusterLabel") %>%
  mutate(ClusterLabel = factor(ClusterLabel, levels = cluster_counts %>%
                                 arrange(desc(CustomerCount)) %>%
                                 pull(ClusterLabel)))
```

```{r}
# Váº½ biá»ƒu Ä‘á»“ káº¿t há»£p
library(viridis)
plot_df$Feature <- factor(plot_df$Feature, levels = c("Recency", "Frequency", "MonetaryValue per 100"))

ggplot(plot_df, aes(x = ClusterLabel)) +
  # Biá»ƒu Ä‘á»“ cá»™t sá»‘ lÆ°á»£ng KH vá»›i viridis
  geom_col(aes(y = CustomerCount, fill = ClusterLabel), width = 0.6) +
  scale_fill_viridis(discrete = TRUE, option = "D") +
  scale_y_continuous(
    name = "Number of Customers",
    sec.axis = sec_axis(~., name = "Average Feature Values")
  ) +
  # Biá»ƒu Ä‘á»“ Ä‘Æ°á»ng trung bÃ¬nh cÃ¡c feature
  geom_line(aes(y = MeanValue, color = Feature, group = Feature), size = 1.2) +
  geom_point(aes(y = MeanValue, color = Feature), size = 2) +
  labs(
    title = "Cluster Distribution with Average Feature Values",
    x = "Cluster Label"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    axis.title.y.left = element_text(color = "black"),
    axis.title.y.right = element_text(color = "darkgreen"),
    legend.title = element_blank()
  )
```

**Nháº­n xÃ©t: NhÃ³m NURTURE:**

  - Sá»‘ lÆ°á»£ng nhiá»u nháº¥t (~5000), Recency cao, Frequency tháº¥p, Monetary tháº¥p

**Ã nghÄ©a:**

  - NhÃ³m khÃ¡ch lÃ¢u khÃ´ng quay láº¡i, Ã­t mua vÃ  chi Ã­t â†’ cáº§n chiáº¿n dá»‹ch khuyáº¿n mÃ£i
  quay láº¡i, kÃ­ch hoáº¡t láº¡i tá»‡p ngá»§ quÃªn.

**Nháº­n xÃ©t: NhÃ³m EXPLORE:**

  - Recency trung bÃ¬nh, Frequency tÄƒng nháº¹, Monetary tÄƒng
  
**Ã nghÄ©a:**

  - NhÃ³m Ä‘ang cÃ³ dáº¥u hiá»‡u báº¯t Ä‘áº§u mua láº¡i, cáº§n Ä‘Æ°á»£c thá»­ nghiá»‡m Æ°u Ä‘Ã£i vÃ  khuyáº¿n
  khÃ­ch Ä‘á»ƒ nÃ¢ng cáº¥p hÃ nh vi mua.

**Nháº­n xÃ©t: NhÃ³m REWARD:**

  - Recency tháº¥p, Frequency cao, Monetary tÄƒng rÃµ

**Ã nghÄ©a:**

  - NhÃ³m cÃ³ hÃ nh vi tá»‘t dáº§n lÃªn -> cÃ³ thá»ƒ táº·ng thÃªm voucher, Æ°u Ä‘Ã£i,...
  
**Nháº­n xÃ©t: NhÃ³m RE-ENGAGE:** 

  - Recency cao, nhÆ°ng Frequency vÃ  Monetary trÆ°á»›c Ä‘Ã³ cao	
  
**Ã nghÄ©a:**

  - NhÃ³m tá»«ng tá»‘t, nay Ä‘Ã£ rá»i bá» -> Ä‘áº·c biá»‡t quan trá»ng Ä‘á»ƒ thu hÃºt trá»Ÿ láº¡i

**Nháº­n xÃ©t: NhÃ³m DELIGHT:**

  - Recency tháº¥p, Frequency á»•n, Monetary cao	

**Ã nghÄ©a:**

  - NhÃ³m Ä‘ang cÃ³ tráº£i nghiá»‡m ráº¥t tá»‘t, cÃ³ thá»ƒ biáº¿n thÃ nh khÃ¡ch trung thÃ nh
  VIP náº¿u cÃ³ chiáº¿n lÆ°á»£c phÃ¹ há»£p.
  
**Nháº­n xÃ©t: NhÃ³m PAMPER :**  

  - Recency tháº¥p nháº¥t, Frequency ráº¥t tháº¥p, Monetary cao nháº¥t	

**Ã nghÄ©a:**

  - NhÃ³m Ã­t mua nhÆ°ng chi ráº¥t máº¡nh tay má»—i láº§n mua -> cáº§n dá»‹ch vá»¥ chÄƒm sÃ³c cÃ¡ nhÃ¢n hÃ³a, quÃ  táº·ng Ä‘áº·c biá»‡t,...









