---
title: "Clean and RFM"
author: "Nguy·ªÖn Nh·∫≠t Nam"
output:
  pdf_document:
    latex_engine: xelatex
    toc: true
    toc_depth: 3
    number_sections: true
    fig_caption: true
    fig_height: 5
    fig_width: 7
    highlight: tango
  html_document:
    toc: true
    toc_depth: '3'
    df_print: paged
  word_document:
    toc: true
    toc_depth: 3
header-includes:
- \usepackage{graphicx}
- \usepackage{fontspec}
- \setmainfont{Times New Roman}
---
```{r}
Sys.setlocale("LC_ALL", "English_United States.UTF-8")

```

```{r message=FALSE, warning=FALSE, paged.print=FALSE}
library(tidyverse)
library(cluster)
library(factoextra)
library(lubridate)
library(scales)
library(psych)
library(readxl)
library(dplyr)
library(ggplot2)
library(plotly)
```
**K-means**

```{r fig.cap="H√¨nh 1: Minh h·ªça thu·∫≠t to√°n DBSCAN", echo=FALSE, out.width="60%",fig.align="center"}
knitr::include_graphics("images/1.png")
```



# ƒê·ªçc v√† kh√°m ph√° d·ªØ li·ªáu

```{r}
# ƒê·ªçc d·ªØ li·ªáu
df <- read_excel("Online Retail.xlsx")
head(df)  

```

  InvoiceNo: M√£ ƒë∆°n h√†ng 
  
  StockCode: M√£ s·∫£n ph·∫©m 
  
  Description: M√¥ t·∫£ s·∫£n ph·∫©m 
  
  Quantity: S·ªë l∆∞·ª£ng s·∫£n ph·∫©m 
  
  InvoiceDate: Ng√†y h√≥a ƒë∆°n 
  
  UnitPrice: Gi√° s·∫£n ph·∫©m tr√™n m·ªói ƒë∆°n v·ªã 
  
  CustomerID: M√£ kh√°ch h√†ng 
  
  Country: Qu·ªëc gia c·ªßa kh√°ch h√†ng
  

```{r}
#Ki·ªÉm tra ki·ªÉu d·ªØ li·ªáu
str(df)
```


```{r}
# th·ªëng k√™ m√¥ t·∫£ d·ªØ li·ªáu 
describe(df)

```

```{r}
# Th·ªëng k√™ data object 
summary(df[, sapply(df, is.character)])
```
```{r}
#ki·ªÉm tra d·ªØ li·ªáu thi·∫øu 
colSums(is.na(df))
```


```{r}
# Ki·ªÉm tra gi√° tr·ªã thi·∫øu c·ªßa CustomerID
df_na <- df[is.na(df$CustomerID), ]
print(df_na[sample(nrow(df_na), 10), ], width = Inf)
```

```{r}
# Chuy·ªÉn 'InvoiceNo' v·ªÅ ki·ªÉu chu·ªói
df$InvoiceNo <- as.character(df$InvoiceNo)
#L·ªçc ra nh·ªØng d√≤ng KH√îNG c√≥ InvoiceNo ƒë√∫ng 6 ch·ªØ s·ªë
df[!grepl("^\\d{6}$", df$InvoiceNo), ]

#Ki·ªÉm tra k√≠ t·ª± kh√°c trong c·ªôt InvoiceNo 
unique(gsub("[0-9]", "", df$InvoiceNo))

# ki·ªÉm tra col 'InvoiceNo' c√≥ gi√° tr·ªã n√†o b·∫Øt ƒë·∫ßu b·∫±ng k√≠ t·ª± 'A' ko
df[grepl("^A", df$InvoiceNo), ]
```
```{r}
# ƒê·∫£m b·∫£o 'StockCode' l√† ki·ªÉu chu·ªói
df$StockCode <- as.character(df$StockCode)
# L·ªçc nh·ªØng d√≤ng KH√îNG ph·∫£i 5 ch·ªØ s·ªë ho·∫∑c 5 ch·ªØ s·ªë + ch·ªØ c√°i
mask <- !(grepl("^\\d{5}$", df$StockCode) | grepl("^\\d{5}[a-zA-Z]+$", df$StockCode))
# L·∫•y c√°c StockCode sai ƒë·ªãnh d·∫°ng v√† lo·∫°i tr√πng
invalid_stockcodes <- unique(df$StockCode[mask])
# Hi·ªÉn th·ªã k·∫øt qu·∫£
print(invalid_stockcodes)
# L·ªçc nh·ªØng d√≤ng c√≥ ch·ª©a chu·ªói 'DOT'
df_with_DOT <- df[grepl("DOT", df$StockCode), ]
# Hi·ªÉn th·ªã k·∫øt qu·∫£
print(df_with_DOT)
```

 **Stock Code**

- **Include** üü¢ ‚Üí Gi·ªØ l·∫°i ƒë·ªÉ ph√¢n t√≠ch ho·∫∑c clustering.  
- **Exclude** ‚ùå ‚Üí Lo·∫°i b·ªè ho√†n to√†n, kh√¥ng d√πng ƒë·ªÉ ph√¢n t√≠ch.  
- **Exclude from clustering** üö´ ‚Üí Kh√¥ng d√πng ƒë·ªÉ ph√¢n nh√≥m nh∆∞ng c√≥ th·ªÉ tham kh·∫£o.  
- **Exclude for now** ‚è≥ ‚Üí T·∫°m lo·∫°i b·ªè, c√≥ th·ªÉ xem x√©t l·∫°i sau. 

- **StockCode** is meant to follow the pattern `[0-9]{5}` but seems to have legit values for `[0-9]{5}[a-zA-Z]+`.  
&nbsp;&nbsp;&nbsp;&nbsp; **Also contains other values:** 



| Code             | Description                                                                 | Action                      |
|------------------|-----------------------------------------------------------------------------|-----------------------------|
| POST            | Not listed previously, likely a postage-related transaction                | Exclude for now             |
| D               | Looks valid, represents discount values                                    | Exclude from clustering     |
| C2              | Carriage transaction - not sure what this means                           | Exclude from clustering     |
| DOT             | Looks valid, represents postage charges                                   | Exclude from clustering     |
| M or m          | Looks valid, represents manual transactions                               | Exclude from clustering     |
| BANK CHARGES or B | Bank charges                                                           | Exclude from clustering     |
| S               | Samples sent to customer                                                 | Exclude from clustering     |
| AMAZONFEE       | Looks like fees for Amazon shipping or something                         | Exclude for now             |
| DCGS0076        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0003        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| gift_0001_40    | Purchases with gift cards, might be interesting for another analysis, but no customer data | Exclude |
| DCGS0070        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| m               | Looks valid, represents manual transactions                              | Exclude from clustering     |
| gift_0001_50    | Purchases with gift cards, might be interesting for another analysis, but no customer data | Exclude |
| gift_0001_30    | Purchases with gift cards, might be interesting for another analysis, but no customer data | Exclude |
| gift_0001_20    | Purchases with gift cards, might be interesting for another analysis, but no customer data | Exclude |
| DCGS0055        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0072        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0074        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0069        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0057        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGSSBOY        | Possible category or bundle-related code                                 | Exclude for now             |
| DCGSSGIRL       | Possible category or bundle-related code                                 | Exclude for now             |
| gift_0001_10    | Purchases with gift cards, might be interesting for another analysis, but no customer data | Exclude |
| PADS            | Looks like a legit stock code for padding                                | Include                     |
| DCGS0004        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0073        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0071        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0068        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0067        | Variant of DCGS, likely falls under the same category                    | Exclude from clustering     |
| DCGS0066P       | Variant of DCGS, possibly a special category                            | Exclude from clustering     |
| B               | Bank charges                                                             | Exclude from clustering     |
| CRUK            | Unknown, possibly a charity-related code                                | Exclude for now             |


# X·ª≠ l√Ω d·ªØ li·ªáu 

```{r}
# Chuy·ªÉn InvoiceDate th√†nh ki·ªÉu Date
df$InvoiceDate <- as.Date(df$InvoiceDate)
str(df)
```

```{r}
# 1. G√°n l·∫°i df g·ªëc
df_cleaned <- df
# Lo·∫°i b·ªè to√†n b·ªô d√≤ng ch·ª©a b·∫•t k·ª≥ k√Ω t·ª± KH√îNG PH·∫¢I s·ªë (0‚Äì9)
df_cleaned <- df_cleaned[grepl("^[0-9]+$", df_cleaned$InvoiceNo), ]

```

```{r}
# Ki·ªÉm tra c√≤n ch·ªØ c√°i kh√¥ng?
any(grepl("[A-Za-z]", df_cleaned$InvoiceNo))  # Ph·∫£i tr·∫£ FALSE

# Ki·ªÉm tra c√≤n k√Ω t·ª± ƒë·∫∑c bi·ªát kh√¥ng?
any(grepl("[^0-9]", df_cleaned$InvoiceNo))    # Ph·∫£i tr·∫£ FALSE
```

```{r}

# T·∫°o ƒëi·ªÅu ki·ªán gi·ªØ l·∫°i c√°c StockCode h·ª£p l·ªá:
mask <- grepl("^\\d{5,6}$", df_cleaned$StockCode) |           # To√†n s·ªë, 5-6 ch·ªØ s·ªë
        grepl("^\\d{5}[A-Za-z]$", df_cleaned$StockCode) |     # 5 s·ªë + 1 ch·ªØ c√°i
        df_cleaned$StockCode == "APADSS"                      # M√£ ƒë·∫∑c bi·ªát

# √Åp d·ª•ng l·ªçc
df_cleaned <- df_cleaned[mask, ]

df_cleaned
```
```{r}
sum(is.na(df$CustomerID))  # ƒë·∫øm s·ªë d√≤ng b·ªã thi·∫øu
```

```{r}
# X√≥a c√°c d√≤ng c√≥ NA ·ªü c·ªôt CustomerID
df_cleaned <- df_cleaned[!is.na(df_cleaned$CustomerID), ]

nrow(df) - nrow(df_cleaned)  # s·ªë d√≤ng ƒë√£ b·ªã x√≥a

colSums(is.na(df_cleaned))
```

```{r}
# th·ªëng k√™ data sau khi drop na
summary(df_cleaned)

```

**Nh·∫≠n x√©t t·ªïng quan v·ªÅ d·ªØ li·ªáu df_cleaned:**




```{r}
# ki·ªÉm tra gi√° tr·ªã b·∫±ng 0 c·ªßa col 'UnitPrice'
sum(df_cleaned$UnitPrice == 0)
# ch·ªâ l·∫•y gi√° tr·ªã kh√°c 0 
df_cleaned <- df_cleaned[df_cleaned$UnitPrice > 0, ]
#Ki·ªÉm tra 
summary(df_cleaned)

```

```{r}
#T√≠nh t·ª∑ l·ªá ph·∫ßn trƒÉm s·ªë d√≤ng c√≤n l·∫°i trong df_cleaned so v·ªõi t·ªïng s·ªë d√≤ng ban ƒë·∫ßu trong df.
sprintf("%.2f%%", nrow(df_cleaned) / nrow(df) * 100)
```


```{r}
##Tr·ª±c quan h√≥a
# S·ªë d√≤ng ban ƒë·∫ßu v√† sau khi l√†m s·∫°ch
total_rows <- nrow(df)
cleaned_rows <- nrow(df_cleaned)
removed_rows <- total_rows - cleaned_rows
# T·∫°o dataframe ƒë·ªÉ v·∫Ω
summary_df <- data.frame(
  Tr·∫°ng_th√°i = c("Gi·ªØ l·∫°i", "ƒê√£ lo·∫°i"),
  S·ªë_l∆∞·ª£ng = c(cleaned_rows, removed_rows)
)
# V·∫Ω bi·ªÉu ƒë·ªì
barplot(
  summary_df$S·ªë_l∆∞·ª£ng,
  names.arg = summary_df$Tr·∫°ng_th√°i,
  col = c("skyblue", "salmon"),
  main = "So s√°nh s·ªë d√≤ng tr∆∞·ªõc v√† sau khi l√†m s·∫°ch",
  ylab = "S·ªë d√≤ng",
  ylim = c(0, max(summary_df$S·ªë_l∆∞·ª£ng) * 1.1)
)
# Hi·ªÉn th·ªã s·ªë li·ªáu tr√™n c·ªôt
text(
  x = c(1, 2),
  y = summary_df$S·ªë_l∆∞·ª£ng,
  labels = summary_df$S·ªë_l∆∞·ª£ng,
  pos = 3,
  cex = 1.2
)
```

##Analysis RFM 

```{r}
# t·∫°o c·ªôt t·ªïng chi ti√™u l√†m Monetary (t·ªïng chi ti√™u)
df_cleaned$SalesLineTotal <- df_cleaned$Quantity * df_cleaned$UnitPrice
# Hi·ªÉn th·ªã k·∫øt qu·∫£
print(df_cleaned, width = Inf)
```


```{r}
aggregated_df <- summarise(
  group_by(df_cleaned, CustomerID),
  MonetaryValue = sum(SalesLineTotal, na.rm = TRUE),
  Frequency = n_distinct(InvoiceNo),
  LastInvoiceDate = max(InvoiceDate)
)
```


```{r}
# T√≠nh Recency
analysis_date <- as.Date(max(df_cleaned$InvoiceDate))
aggregated_df$Recency <- as.numeric(analysis_date - aggregated_df$LastInvoiceDate)

print(aggregated_df, width = Inf)

```

```{r}
# Thi·∫øt l·∫≠p b·ªë c·ª•c 1 h√†ng 3 bi·ªÉu ƒë·ªì
par(mfrow = c(1, 3), mar = c(4, 4, 3, 1))  # 1 d√≤ng, 3 c·ªôt

# Bi·ªÉu ƒë·ªì 1: Monetary Value
hist(aggregated_df$MonetaryValue,
     breaks = 10,
     col = "skyblue",
     border = "red",
     main = "Monetary Value Distribution",
     xlab = "Monetary Value",
     ylab = "Count")

# Bi·ªÉu ƒë·ªì 2: Frequency
hist(aggregated_df$Frequency,
     breaks = 10,
     col = "lightgreen",
     border = "red",
     main = "Frequency Distribution",
     xlab = "Frequency",
     ylab = "Count")

# Bi·ªÉu ƒë·ªì 3: Recency
hist(aggregated_df$Recency,
     breaks = 20,
     col = "yellow",
     border = "red",
     main = "Recency Distribution",
     xlab = "Recency",
     ylab = "Count")

# Reset layout v·ªÅ m·∫∑c ƒë·ªãnh (1 bi·ªÉu ƒë·ªì/khung)
par(mfrow = c(1, 1))
```
**Nh·∫≠n x√©t**

  - **Monetary Value Distribution (Gi√° tr·ªã chi ti√™u):**
  
      * Ph√¢n b·ªë r·∫•t l·ªách ph·∫£i (right-skewed).

      * Ph·∫ßn l·ªõn kh√°ch h√†ng c√≥ t·ªïng chi ti√™u (Monetary) r·∫•t th·∫•p (ƒëa s·ªë < 10,000).

      * Ch·ªâ m·ªôt s·ªë √≠t kh√°ch chi ti√™u r·∫•t cao (c√≥ gi√° tr·ªã t·ªõi 250,000+), t·∫°o ra outlier r·∫•t m·∫°nh.
      
  - **K·∫øt lu·∫≠n:**
    
      * T·∫≠p kh√°ch h√†ng c√≥ s·ª± kh√°c bi·ªát l·ªõn v·ªÅ gi√° tr·ªã ‚Äì ph√π h·ª£p ƒë·ªÉ ph√¢n nh√≥m (clustering).
    
      * N√™n xem x√©t log-transform ho·∫∑c winsorizing tr∆∞·ªõc khi d√πng cho m√¥ h√¨nh.
    
  - **Frequency Distribution (T·∫ßn su·∫•t mua h√†ng):**

      * C·ª±c k·ª≥ l·ªách ph·∫£i: g·∫ßn nh∆∞ t·∫•t c·∫£ kh√°ch ch·ªâ mua 1‚Äì2 l·∫ßn.

      * R·∫•t √≠t kh√°ch h√†ng mua t·ª´ 10 l·∫ßn tr·ªü l√™n (hi·∫øm c√≥ >50).

      * M·ªôt v√†i gi√° tr·ªã l·ªõn (outlier) v·∫´n t·ªìn t·∫°i.

  - **K·∫øt lu·∫≠n:**
  
      * Ph·∫ßn l·ªõn kh√°ch h√†ng kh√¥ng trung th√†nh ‚Üí ch·ªâ mua 1 l·∫ßn.

      * R·∫•t c·∫ßn ph√°t tri·ªÉn nh√≥m kh√°ch ‚Äúfrequent buyers‚Äù (n·∫øu mu·ªën tƒÉng CLV).

      * C√≥ th·ªÉ t·∫°o ch√≠nh s√°ch ∆∞u ƒë√£i t·∫ßn su·∫•t cho nh√≥m ti·ªÅm nƒÉng.

  - **Recency Distribution (Kho·∫£ng th·ªùi gian k·ªÉ t·ª´ l·∫ßn mua g·∫ßn nh·∫•t):**

      * Ph√¢n b·ªë c≈©ng l·ªách ph·∫£i nh∆∞ng nh·∫π h∆°n.

      * Nhi·ªÅu kh√°ch h√†ng m·ªõi mua g·∫ßn ƒë√¢y (Recency th·∫•p) ‚Üí t·∫≠p trung ·ªü kho·∫£ng 0‚Äì50 ng√†y.

      * C√†ng xa (Recency cao), s·ªë l∆∞·ª£ng kh√°ch gi·∫£m d·∫ßn ‚Üí bi·ªÉu hi·ªán t·ªët.

  - **K·∫øt lu·∫≠n:**
  
      * C√≥ nhi·ªÅu kh√°ch h√†ng m·ªõi ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y.

      * C∆° h·ªôi r·∫•t t·ªët ƒë·ªÉ ch·∫°y l·∫°i remarketing ho·∫∑c t√°i k√≠ch ho·∫°t kh√°ch c≈©.

      * T·∫≠p kh√°ch c≈© (Recency > 250) c√≥ th·ªÉ l√† kh√°ch r·ªùi b·ªè.
      
**ki·ªÉm tra outlier**

```{r}
data_outliers <- aggregated_df
```

```{r}
# ƒê·∫∑t layout: 1 h√†ng, 3 bi·ªÉu ƒë·ªì
par(mfrow = c(1, 3), mar = c(4, 4, 3, 1))

# Boxplot 1: MonetaryValue
boxplot(aggregated_df$MonetaryValue,
        col = "skyblue",
        main = "Monetary Value Boxplot",
        xlab = "Monetary Value")

# Boxplot 2: Frequency
boxplot(aggregated_df$Frequency,
        col = "lightgreen",
        main = "Frequency Boxplot",
        xlab = "Frequency")

# Boxplot 3: Recency
boxplot(aggregated_df$Recency,
        col = "salmon",
        main = "Recency Boxplot",
        xlab = "Recency")

# Reset l·∫°i layout v·ªÅ m·∫∑c ƒë·ªãnh (1 bi·ªÉu ƒë·ªì)
par(mfrow = c(1, 1))
```


```{r}
# T√≠nh Q1, Q3 v√† IQR cho MonetaryValue
M_Q1 <- quantile(aggregated_df$MonetaryValue, 0.25)
M_Q3 <- quantile(aggregated_df$MonetaryValue, 0.75)
M_IQR <- M_Q3 - M_Q1

# L·ªçc c√°c d√≤ng l√† outlier
monetary_outliers_df <- aggregated_df[
  aggregated_df$MonetaryValue < (M_Q1 - 1.5 * M_IQR) |
  aggregated_df$MonetaryValue > (M_Q3 + 1.5 * M_IQR),
]

# Xem m√¥ t·∫£ d·ªØ li·ªáu outlier
summary(monetary_outliers_df)

```

```{r}
# T√≠nh Q1, Q3 v√† IQR cho Frequency
F_Q1 <- quantile(aggregated_df$Frequency, 0.25)
F_Q3 <- quantile(aggregated_df$Frequency, 0.75)
F_IQR <- F_Q3 - F_Q1

# L·ªçc c√°c d√≤ng l√† outlier theo Frequency
frequency_outliers_df <- aggregated_df[
  aggregated_df$Frequency < (F_Q1 - 1.5 * F_IQR) |
  aggregated_df$Frequency > (F_Q3 + 1.5 * F_IQR),
]

# Th·ªëng k√™ d·ªØ li·ªáu outlier
summary(frequency_outliers_df)

```

```{r}
# Lo·∫°i b·ªè outlier b·∫±ng c√°ch gi·ªØ l·∫°i c√°c d√≤ng KH√îNG n·∫±m trong monetary v√† frequency outliers

# L·∫•y ch·ªâ s·ªë h√†ng (index) c·∫ßn lo·∫°i b·ªè
outlier_indices <- union(
  which(aggregated_df$MonetaryValue < (M_Q1 - 1.5 * M_IQR) | aggregated_df$MonetaryValue > (M_Q3 + 1.5 * M_IQR)),
  which(aggregated_df$Frequency < (F_Q1 - 1.5 * F_IQR) | aggregated_df$Frequency > (F_Q3 + 1.5 * F_IQR))
)

# Gi·ªØ l·∫°i c√°c d√≤ng kh√¥ng n·∫±m trong ch·ªâ s·ªë outlier
non_outliers_df <- aggregated_df[-outlier_indices, ]

# Ki·ªÉm tra l·∫°i
summary(non_outliers_df)

```


```{r}
# Tr·ª±c quan sau khi lo·∫°i b·ªè 
# Chia khung h√¨nh ra 1 d√≤ng 3 bi·ªÉu ƒë·ªì
par(mfrow = c(1, 3), mar = c(4, 4, 3, 1))

# Boxplot 1: Monetary Value
boxplot(non_outliers_df$MonetaryValue,
        col = "skyblue",
        main = "Monetary Value Boxplot",
        xlab = "Monetary Value")

# Boxplot 2: Frequency
boxplot(non_outliers_df$Frequency,
        col = "lightgreen",
        main = "Frequency Boxplot",
        xlab = "Frequency")

# Boxplot 3: Recency
boxplot(non_outliers_df$Recency,
        col = "salmon",
        main = "Recency Boxplot",
        xlab = "Recency")

# Reset l·∫°i layout v·ªÅ m·∫∑c ƒë·ªãnh
par(mfrow = c(1, 1))
```


```{r}
# V·∫Ω scatter plot 3D
ggplot(non_outliers_df, aes(x = MonetaryValue, y = Frequency, color = Recency)) +
  geom_point(alpha = 0.7, size = 2) +
  scale_color_gradient(low = "skyblue", high = "darkblue") +
  labs(
    title = "Ph√¢n b·ªë kh√°ch h√†ng theo Monetary - Frequency - Recency (2D)",
    x = "Monetary Value",
    y = "Frequency",
    color = "Recency"
  ) +
  theme_minimal()

```
```{r}
# Chu·∫©n h√≥a c√°c c·ªôt MonetaryValue, Frequency, Recency
scaled_data <- scale(non_outliers_df[, c("MonetaryValue", "Frequency", "Recency")])
```

```{r}
# Chuy·ªÉn matrix chu·∫©n h√≥a v·ªÅ data.frame
scaled_data_df <- as.data.frame(scaled_data)

# ƒê·∫∑t l·∫°i t√™n c·ªôt
colnames(scaled_data_df) <- c("MonetaryValue", "Frequency", "Recency")

# G√°n l·∫°i rownames n·∫øu c·∫ßn gi·ªØ index
rownames(scaled_data_df) <- rownames(non_outliers_df)
# Xem k·∫øt qu·∫£
head(scaled_data_df)
```

```{r}
ggplot(scaled_data_df, aes(x = MonetaryValue, y = Frequency, color = Recency)) +
  geom_point(alpha = 0.7, size = 2) +
  scale_color_gradient(low = "skyblue", high = "darkblue") +
  labs(
    title = "2D Scatter Plot (Recency as Color)",
    x = "Monetary (Scaled)",
    y = "Frequency (Scaled)",
    color = "Recency (Scaled)"
  ) +
  theme_minimal()
```

